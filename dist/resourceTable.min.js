/*https://github.com/nurun/resourceTable*/
!function(){function a(a,b){var c=document.createElementNS(i,"svg:svg"),d=2*Math.PI/100,e=0,f=function(a,b,c,d){var e=document.createElementNS(i,"circle");return e.setAttributeNS(null,"cx",a),e.setAttributeNS(null,"cy",b),e.setAttributeNS(null,"r",c),e.setAttributeNS(null,"fill",d),e},g=function(a){var b=document.createElementNS(i,"svg:svg");b.style.visibility="hidden",b.appendChild(a),document.body.appendChild(b);var c=a.getBBox().width;return b.parentNode.removeChild(b),c},h=function(a,b,c,f,h){var j=document.createElementNS(i,"path"),k=e+(c*d-.001),l=e+(c/2*d-.001),m=b/2+b/2*Math.sin(e),n=b/2-b/2*Math.cos(e),o=b/2+b/2*Math.sin(k),p=b/2-b/2*Math.cos(k),q=b/2+b/2.3*Math.sin(l),r=b/2-b/2.3*Math.cos(l),s=k-e>Math.PI?1:0,t="M "+b/2+","+b/2+" L "+m+","+n+" A "+b/2+","+b/2+" 0 "+s+" 1 "+o+","+p+" Z";j.setAttribute("d",t),j.setAttribute("fill",h),j.setAttribute("id",a);var u=document.createElementNS(i,"title");if(u.textContent=f,j.appendChild(u),j.addEventListener("mouseover",function(a){a.target.setAttribute("fill","#ccc"),document.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="#ccc"}),j.addEventListener("mouseout",function(a){a.target.setAttribute("fill",h),document.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="transparent"}),e=k,c>10){var v=document.createElementNS(i,"text");return v.style.pointerEvents="none",v.textContent=f,v.setAttribute("y",r),v.style.textShadow="0 0 2px #fff",v.style.pointerEvents="none",l<Math.PI?v.setAttribute("x",q-g(v)):v.setAttribute("x",q),[j,v]}return[j]};c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("viewBox","0 0 "+b+" "+b);var j=document.createElementNS(i,"g");return j.style.pointerEvents="none",a.forEach(function(a){var d=a.label+" ("+a.count+")",e=h(a.id,b,a.perc,d,k());c.appendChild(e[0]),e[1]&&j.appendChild(e[1])}),c.appendChild(f(b/2,b/2,.05*b,"#fff")),c.appendChild(j),c}var b,c,d,e,f=[],g=[],h=[];if(window.performance&&void 0!==window.performance.getEntriesByType)b=window.performance.getEntriesByType("resource"),c=window.performance.getEntriesByType("mark");else{if(!window.performance||void 0===window.performance.webkitGetEntriesByType)return void alert("Oups, looks like this browser does not support the Ressource Timing API\ncheck http://caniuse.com/#feat=resource-timing to see the ones supporting it \n\n");b=window.performance.webkitGetEntriesByType("resource"),c=window.performance.webkitGetEntriesByType("mark")}window.performance.timing?d=window.performance.timing:alert("Oups, looks like this browser does not support performance timing");var i="http://www.w3.org/2000/svg";b=b.filter(function(a){return!a.name.match(/http[s]?\:\/\/nurun.github.io\/resourceTable\/.*/)});var j=function(a,b,c,d){var e=document.createElement(a);return e.textContent=c||"",e.style.cssText=d||"",e.id=b||"",e},k=function(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b},l=function(a,b){var c={},d=[];a.forEach(function(a){c[a]=c[a]?c[a]+1:1});for(var e in c)obj={},obj[b||"key"]=e,obj.count=c[e],d.push(obj);return d.sort(function(a,b){return a.count<b.count?1:-1})};if(e=document.getElementById("resourceTable-holder"))for(;e.firstChild;)e.removeChild(e.firstChild);else e=j("div","resourceTable-holder","","position:absolute; top:0; left:0; z-index: 9999; padding:1em 1em 3em; background:rgba(255,255,255, 0.95);");var m=function(a,b){var c=j("div","","","float:left; width:100%; overflow-x:auto"),d=j("table","","","float:left; width:100%;"),e=j("thead"),f=j("tbody");return e.appendChild(j("th","",a,"text-align: left; padding:0 0.5em 0 0;")),e.appendChild(j("th","","Requests","text-align: left; padding:0 0.5em 0 0;")),e.appendChild(j("th","","Percentage","text-align: left; padding:0 0.5em 0 0;")),d.appendChild(e),b.forEach(function(a){var b=j("tr",a.id+"-table");b.appendChild(j("td","",a.label)),b.appendChild(j("td","",a.count)),b.appendChild(j("td","",a.perc.toPrecision(2)+"%")),f.appendChild(b)}),d.appendChild(f),c.appendChild(d),c};h=b.map(function(a){var b=a.name.match(/:\/\/(.[^/]+)([^?]*)\??(.*)/),c=b[2].split("/").pop(),d=c.substr((Math.max(0,c.lastIndexOf("."))||1/0)+1),e={name:a.name,domain:b[1],initiatorType:a.initiatorType||d||"SourceMap or Not Defined",fileExtension:d||"XHR or Not Defined",loadtime:a.duration,isLocalDomain:b[1]===location.host};return a.requestStart&&(e.requestStartDelay=a.requestStart-a.startTime,e.dns=a.domainLookupEnd-a.domainLookupStart,e.tcp=a.connectEnd-a.connectStart,e.ttfb=a.responseStart-a.startTime,e.requestDuration=a.responseStart-a.requestStart),a.secureConnectionStart&&(e.ssl=a.connectEnd-a.secureConnectionStart),e.isLocalDomain?f.push(e):g.push(e),e});var n=l(h.map(function(a){return a.initiatorType}),"fileType"),o=l(h.map(function(a){return a.initiatorType+" "+(a.isLocalDomain?"(local)":"(extenal)")}),"fileType"),p=l(h.map(function(a){return a.domain}),"domain"),q=function(c,d){var f=j("div","","","float:left; width:28%; margin: 0 5.3333% 0 0;");f.appendChild(j("h1","",c,"font:bold 16px/18px sans-serif; margin:1em 0;")),f.appendChild(a(d,400)),f.appendChild(j("p","","total requests: ("+b.length+")")),f.appendChild(m(c,d)),e.appendChild(f)},r=b.length/100;q("Requests by Domain",p.map(function(a){return a.perc=a.count/r,a.label=a.domain,a.id="reqByDomain-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),q("Requests by Type (local/external domain)",o.map(function(a){return a.perc=a.count/r,a.label=a.fileType,a.id="reqByTypeLocEx-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),q("Requests by Type",n.map(function(a){return a.perc=a.count/r,a.label=a.fileType,a.id="reqByType-"+a.label.replace(/[^a-zA-Z]/g,"-"),a}));var s;!function(){s={totals:{pageLoadTime:d.loadEventEnd-d.navigationStart,ttfb:d.responseStart-d.navigationStart,domProcessing:d.domComplete-d.domLoading}};var a,b=d.navigationStart;for(var c in d)d.hasOwnProperty(c)&&d[c]&&(s[c]=d[c]-b,a=c.match(/(.*)End$/),a&&d[a[1]+"Start"]&&(s.totals[a[1]]=d[c]-d[a[1]+"Start"]));var f=function(a,b,c){return{name:a,start:b,end:c,total:c-b}};s.blocks=[f("DOM Processing",s.unloadEventStart,s.unloadEventStart),f("unload",s.unloadEventStart,s.unloadEventEnd),f("redirect",s.redirectStart,s.redirectEnd),f("App cache",s.fetchStart,s.domainLookupStart),f("DNS",s.domainLookupStart,s.domainLookupEnd),f("TCP",s.connectStart,s.connectEnd),f("Request",s.requestStart,s.responseStart),f("Response",s.responseStart,s.responseEnd),f("DOM Processing",s.domLoading,s.domComplete),f("Onload Event",s.loadEventStart,s.loadEventEnd)],s.secureConnectionStart&&s.blocks.push(f("SSL",s.connectStart,s.secureConnectionStart));var g=function(){var a=j("div","","","float:left; width:100%; margin: 25px 0;"),b="http://www.w3.org/2000/svg",c=document.createElementNS(b,"svg:svg");c.setAttributeNS(null,"width","100%"),c.setAttributeNS(null,"height",15*s.blocks.length+"px"),c.setAttributeNS(null,"fill","#ccc");var d=document.createElementNS(b,"svg:svg");d.setAttributeNS(null,"width","100%");var f=s.totals.pageLoadTime/100,g=function(a,c,d,e,g,h){var i=document.createElementNS(b,"rect");if(i.setAttributeNS(null,"width",a/f+"%"),i.setAttributeNS(null,"height",c+"px"),i.setAttributeNS(null,"x",d/f+"%"),i.setAttributeNS(null,"y",e+"px"),i.setAttributeNS(null,"fill",g),h){var j=document.createElementNS(b,"title");j.textContent=h,i.appendChild(j)}return i},h=g(100*f,25,0,0,"#ccc");c.appendChild(h),s.blocks.forEach(function(a,e){c.appendChild(g(a.total||1,25,a.start||.001,0,k(),a.name+" ("+a.total+"ms)"));var h=document.createElementNS(b,"text");h.style.pointerEvents="none",h.textContent=a.name+" ("+a.total+"ms)",h.setAttribute("y",15*e+45+"px"),h.style.textShadow="0 0 2px #fff",h.style.pointerEvents="none",h.setAttribute("x",(a.start||.001)/f+"%"),d.appendChild(h)}),c.appendChild(d),a.appendChild(c),e.insertBefore(a,e.firstChild)};g()}(),document.body.appendChild(e),console.log("\n\n\nAll loaded ressources:"),console.table(h),console.log("\n\n\nRequests by domain"),console.table(p,["domain","count","perc"]),console.log("\n\n\nFile type count (local / external):"),console.table(o,["fileType","count","perc"]),console.log("\n\n\nFile type count:"),console.table(n,["fileType","count","perc"]),console.log("\n\n\nNavigation Timeline:"),console.table(s.blocks),console.log("\n\n\nAll times (in ms since navigationStart):"),console.log(s)}();