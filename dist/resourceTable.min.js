/*https://github.com/nurun/resourceTable*/
!function(){var a,b,c,d,e,f=[];if(window.performance&&void 0!==window.performance.getEntriesByType)a=window.performance.getEntriesByType("resource"),b=window.performance.getEntriesByType("mark");else{if(!window.performance||void 0===window.performance.webkitGetEntriesByType)return void alert("Oups, looks like this browser does not support the Ressource Timing API\ncheck http://caniuse.com/#feat=resource-timing to see the ones supporting it \n\n");a=window.performance.webkitGetEntriesByType("resource"),b=window.performance.webkitGetEntriesByType("mark")}window.performance.timing?c=window.performance.timing:alert("Oups, looks like this browser does not support performance timing"),a=a.filter(function(a){return!a.name.match(/http[s]?\:\/\/nurun.github.io\/resourceTable\/.*/)});var g=function(a,b,c){b=b||{};var d=document.createElement(a);for(var e in b)"text"!=e&&(d[e]=b[e]);return d.textContent=b.text,d.style.cssText=c||"",d},h=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);for(var e in b)"text"!=e&&d.setAttributeNS(null,e,b[e]);return d.textContent=b.text,d.style.cssText=c||"",d},i=function(a,b,c){return h("text",{fill:"#111",y:b,text:a},(c||"")+" text-shadow:0 0 2px #fff;")},j=function(a){var b=h("svg:svg",{},"visibility:hidden;");b.appendChild(a),document.body.appendChild(b);var c=a.getBBox().width;return b.parentNode.removeChild(b),c},k=function(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b},l=function(a,b){var c={},d=[];a.forEach(function(a){c[a]=c[a]?c[a]+1:1});for(var e in c)obj={},obj[b||"key"]=e,obj.count=c[e],d.push(obj);return d.sort(function(a,b){return a.count<b.count?1:-1})};if(d=document.getElementById("resourceTable-holder"))for(e=document.getElementById("resourceTable-content");e.firstChild;)e.removeChild(e.firstChild);else{d=g("div",{id:"resourceTable-holder"},"position:absolute; top:0; left:0; z-index: 9999; font:normal 12px/18px sans-serif; width:100%; padding:1em 1em 3em; box-sizing:border-box; background:rgba(255, 255, 255, 1);"),e=g("div",{id:"resourceTable-content"},"position:relative;");var m=g("button",{id:"resourceTable-close",text:"close"},"position:absolute; top:0; right:0; padding:1em 0.5em; z-index:1; background:transparent; border:0;");m.addEventListener("click",function(){d.parentNode.removeChild(d)}),d.appendChild(m),d.appendChild(e)}!function(){function b(a,b){var c=h("svg:svg",{width:"100%",height:"100%",viewBox:"0 0 "+b+" "+b}),d=2*Math.PI/100,e=0,f=function(a,b,c,f,g){var k=b/2,l=e+(c*d-.001),m=e+(c/2*d-.001),n=k+k*Math.sin(e),o=k-k*Math.cos(e),p=k+k*Math.sin(l),q=k-k*Math.cos(l),r=k+.85*k*Math.sin(m),s=k-.85*k*Math.cos(m),t=l-e>Math.PI?1:0,u="M "+k+","+k+" L "+n+","+o+" A "+k+","+k+" 0 "+t+" 1 "+p+","+q+" Z",v=h("path",{id:a,d:u,fill:g});if(v.appendChild(h("title",{text:f})),v.addEventListener("mouseover",function(a){a.target.setAttribute("fill","#ccc"),document.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="#ccc"}),v.addEventListener("mouseout",function(a){a.target.setAttribute("fill",g),document.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="transparent"}),e=l,c>10){var w=i(f,s,"pointer-events:none;");return m<Math.PI?w.setAttribute("x",r-j(w)):w.setAttribute("x",r),{path:v,wedgeLabel:w}}return{path:v}},g=h("g",{},"pointer-events: none;");return a.forEach(function(a){var d=f(a.id,b,a.perc,a.label+" ("+a.count+")",k());c.appendChild(d.path),d.wedgeLabel&&g.appendChild(d.wedgeLabel)}),c.appendChild(h("circle",{cx:b/2,cy:b/2,r:.05*b,fill:"#fff"})),c.appendChild(g),c}var c=function(a,b){var c=g("div",{},"float:left; width:100%; overflow-x:auto"),d=g("table",{},"float:left; width:100%;"),e=g("thead"),f=g("tbody");return e.appendChild(g("th",{text:a},"text-align: left; padding:0 0.5em 0 0;")),e.appendChild(g("th",{text:"Requests"},"text-align: left; padding:0 0.5em 0 0;")),e.appendChild(g("th",{text:"Percentage"},"text-align: left; padding:0 0.5em 0 0;")),d.appendChild(e),b.forEach(function(a){var b=g("tr",{id:a.id+"-table"});b.appendChild(g("td",{text:a.label})),b.appendChild(g("td",{text:a.count})),b.appendChild(g("td",{text:a.perc.toPrecision(2)+"%"})),f.appendChild(b)}),d.appendChild(f),c.appendChild(d),c},d=a.map(function(a){var b=a.name.match(/:\/\/(.[^/]+)([^?]*)\??(.*)/),c=b[2].split("/").pop(),d=c.substr((Math.max(0,c.lastIndexOf("."))||1/0)+1),e={name:a.name,domain:b[1],initiatorType:a.initiatorType||d||"SourceMap or Not Defined",fileExtension:d||"XHR or Not Defined",loadtime:a.duration,isLocalDomain:b[1]===location.host};return a.requestStart&&(e.requestStartDelay=a.requestStart-a.startTime,e.dns=a.domainLookupEnd-a.domainLookupStart,e.tcp=a.connectEnd-a.connectStart,e.ttfb=a.responseStart-a.startTime,e.requestDuration=a.responseStart-a.requestStart),a.secureConnectionStart&&(e.ssl=a.connectEnd-a.secureConnectionStart),e});fileExtensionCounts=l(d.map(function(a){return a.initiatorType}),"fileType"),fileExtensionCountLocalExt=l(d.map(function(a){return a.initiatorType+" "+(a.isLocalDomain?"(local)":"(extenal)")}),"fileType"),requestsByDomain=l(d.map(function(a){return a.domain}),"domain");var m=function(d,f){var h=g("div",{},"float:left; width:28%; margin: 0 5.3333% 0 0;");h.appendChild(g("h1",{text:d},"font:bold 16px/18px sans-serif; margin:1em 0; color:#666;")),h.appendChild(b(f,400)),h.appendChild(g("p",{text:"total requests: ("+a.length+")"})),h.appendChild(c(d,f)),e.appendChild(h)},n=a.length/100;m("Requests by Domain",requestsByDomain.map(function(a){return a.perc=a.count/n,a.label=a.domain,a.id="reqByDomain-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),m("Requests by Type (local/external domain)",fileExtensionCountLocalExt.map(function(a){return a.perc=a.count/n,a.label=a.fileType,a.id="reqByTypeLocEx-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),m("Requests by Type",fileExtensionCounts.map(function(a){return a.perc=a.count/n,a.label=a.fileType,a.id="reqByType-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),f=f.concat(f,[{name:"All loaded ressources",data:d},{name:"Requests by domain",data:requestsByDomain},{name:"File type count (local / external)",data:fileExtensionCounts},{name:"File type count",data:fileExtensionCountLocalExt}])}(),function(){var a={pageLoadTime:c.loadEventEnd-c.navigationStart,output:[]},b=c.navigationStart;for(var d in c)c.hasOwnProperty(d)&&c[d]&&(a[d]=c[d]-b,a.output.push({name:d,"time (ms)":c[d]-b}));a.output.sort(function(a,b){return(a["time (ms)"]||0)-(b["time (ms)"]||0)});var j=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}};a.blocks=[j("total",0,a.pageLoadTime,"#ccc"),j("ttfb",a.navigationStart,a.responseStart,"#bbb"),j("unload",a.unloadEventStart,a.unloadEventEnd,"#909"),j("redirect",a.redirectStart,a.redirectEnd,"#009"),j("App cache",a.fetchStart,a.domainLookupStart,"#099"),j("DNS",a.domainLookupStart,a.domainLookupEnd,"#090"),j("TCP",a.connectStart,a.connectEnd,"#990"),j("Request",a.requestStart,a.responseStart,"#c90"),j("Response",a.responseStart,a.responseEnd,"#6c0"),j("DOM Processing",a.domLoading,a.domComplete,"#9cc"),j("domContentLoaded Event",a.domContentLoadedEventStart,a.domContentLoadedEventEnd,"#c33"),j("Onload Event",a.loadEventStart,a.loadEventEnd,"#cf3")],a.secureConnectionStart&&a.blocks.push(j("SSL",a.connectStart,a.secureConnectionStart,"#990"));var k=function(){var b=g("div",{},"float:left; width:100%; margin: 25px 0;"),c=h("svg:svg",{width:"100%",height:25*a.blocks.length+"px",fill:"#ccc"}),d=h("g",{width:"100%"}),f=a.pageLoadTime/100,j=function(a,b,c,d,e,g){var i=h("rect",{width:a/f+"%",height:b+"px",x:c/f+"%",y:d+"px",fill:e});return g&&i.appendChild(h("title",{text:g})),i},k=function(){for(var b=h("g",{width:"100%"}),c=0,d=a.pageLoadTime/1e3,e=100/d;d>=c;c++){var f=i(c+"sec","100%");c>d-.2?(f.setAttribute("x",e*c-.5+"%"),f.setAttribute("text-anchor","end")):f.setAttribute("x",e*c+.5+"%");var g=h("line",{x1:e*c+"%",y1:"0px",x2:e*c+"%",y2:"100%"},"stroke:#ccc; stroke-width:1");b.appendChild(g),b.appendChild(f)}return b};c.appendChild(k());var l=a.blocks.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)});l.forEach(function(a,b){var e=a.total||1,g=25*b;c.appendChild(j(e,25,a.start||.001,g,a.colour,a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)"));var h=i(a.name+" ("+a.total+"ms)",g+18+"px");(a.total||1)/f>10?(h.setAttribute("x",(a.start||.001)/f+.5+"%"),h.setAttribute("width",e/f+"%")):(a.start||.001)/f+e/f<80?h.setAttribute("x",(a.start||.001)/f+e/f+.5+"%"):(h.setAttribute("x",(a.start||.001)/f-.5+"%"),h.setAttribute("text-anchor","end")),d.appendChild(h)}),c.appendChild(d),b.appendChild(g("h1",{text:"Navigation Timing"},"font:bold 16px/18px sans-serif; margin:1em 0; color:#666;")),b.appendChild(c),e.insertBefore(b,e.firstChild)};k(),f=f.concat(f,[{name:"Navigation Timeline",data:a.blocks,columns:["name","start","end","total"]},{name:"Navigation Events",data:a.output}])}(),document.body.appendChild(d),f.forEach(function(a){console.log("\n\n\n"+a.name+":"),console.table(a.data,a.columns)})}();