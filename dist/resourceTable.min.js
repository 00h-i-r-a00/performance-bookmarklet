/*https://github.com/nurun/resourceTable*/
!function(){function a(a,b){var c=k("svg:svg",{width:"100%",height:"100%",viewBox:"0 0 "+b+" "+b}),d=2*Math.PI/100,e=0,f=function(a,b,c,f,g){var h=b/2,i=e+(c*d-.001),j=e+(c/2*d-.001),n=h+h*Math.sin(e),o=h-h*Math.cos(e),p=h+h*Math.sin(i),q=h-h*Math.cos(i),r=h+.85*h*Math.sin(j),s=h-.85*h*Math.cos(j),t=i-e>Math.PI?1:0,u="M "+h+","+h+" L "+n+","+o+" A "+h+","+h+" 0 "+t+" 1 "+p+","+q+" Z",v=k("path",{id:a,d:u,fill:g});if(v.appendChild(k("title",{text:f})),v.addEventListener("mouseover",function(a){a.target.setAttribute("fill","#ccc"),document.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="#ccc"}),v.addEventListener("mouseout",function(a){a.target.setAttribute("fill",g),document.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="transparent"}),e=i,c>10){var w=l(f,s,"pointer-events:none;");return j<Math.PI?w.setAttribute("x",r-m(w)):w.setAttribute("x",r),{path:v,wedgeLabel:w}}return{path:v}},g=k("g",{},"pointer-events: none;");return a.forEach(function(a){var d=f(a.id,b,a.perc,a.label+" ("+a.count+")",n());c.appendChild(d.path),d.wedgeLabel&&g.appendChild(d.wedgeLabel)}),c.appendChild(k("circle",{cx:b/2,cy:b/2,r:.05*b,fill:"#fff"})),c.appendChild(g),c}var b,c,d,e,f,g=[],h=[],i=[];if(window.performance&&void 0!==window.performance.getEntriesByType)b=window.performance.getEntriesByType("resource"),c=window.performance.getEntriesByType("mark");else{if(!window.performance||void 0===window.performance.webkitGetEntriesByType)return void alert("Oups, looks like this browser does not support the Ressource Timing API\ncheck http://caniuse.com/#feat=resource-timing to see the ones supporting it \n\n");b=window.performance.webkitGetEntriesByType("resource"),c=window.performance.webkitGetEntriesByType("mark")}window.performance.timing?d=window.performance.timing:alert("Oups, looks like this browser does not support performance timing"),b=b.filter(function(a){return!a.name.match(/http[s]?\:\/\/nurun.github.io\/resourceTable\/.*/)});var j=function(a,b,c){b=b||{};var d=document.createElement(a);for(var e in b)"text"!=e&&(d[e]=b[e]);return d.textContent=b.text,d.style.cssText=c||"",d},k=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);for(var e in b)"text"!=e&&d.setAttributeNS(null,e,b[e]);return d.textContent=b.text,d.style.cssText=c||"",d},l=function(a,b,c){return k("text",{fill:"#111",y:b,text:a},(c||"")+" text-shadow:0 0 2px #fff;")},m=function(a){var b=k("svg:svg",{},"visibility:hidden;");b.appendChild(a),document.body.appendChild(b);var c=a.getBBox().width;return b.parentNode.removeChild(b),c},n=function(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b},o=function(a,b){var c={},d=[];a.forEach(function(a){c[a]=c[a]?c[a]+1:1});for(var e in c)obj={},obj[b||"key"]=e,obj.count=c[e],d.push(obj);return d.sort(function(a,b){return a.count<b.count?1:-1})};if(e=document.getElementById("resourceTable-holder"))for(f=document.getElementById("resourceTable-content");f.firstChild;)f.removeChild(f.firstChild);else{e=j("div",{id:"resourceTable-holder"},"position:absolute; top:0; left:0; z-index: 9999; font:normal 12px/18px sans-serif; padding:1em 1em 3em; background:rgba(255, 255, 255, 1);"),f=j("div",{id:"resourceTable-content"},"position:relative;");var p=j("button",{id:"resourceTable-close",text:"close"},"position:absolute; top:0; right:0; padding:1em 0.5em; z-index:1; background:transparent; border:0;");p.addEventListener("click",function(){e.parentNode.removeChild(e)}),e.appendChild(p),e.appendChild(f)}var q=function(a,b){var c=j("div",{},"float:left; width:100%; overflow-x:auto"),d=j("table",{},"float:left; width:100%;"),e=j("thead"),f=j("tbody");return e.appendChild(j("th",{text:a},"text-align: left; padding:0 0.5em 0 0;")),e.appendChild(j("th",{text:"Requests"},"text-align: left; padding:0 0.5em 0 0;")),e.appendChild(j("th",{text:"Percentage"},"text-align: left; padding:0 0.5em 0 0;")),d.appendChild(e),b.forEach(function(a){var b=j("tr",{id:a.id+"-table"});b.appendChild(j("td",{text:a.label})),b.appendChild(j("td",{text:a.count})),b.appendChild(j("td",{text:a.perc.toPrecision(2)+"%"})),f.appendChild(b)}),d.appendChild(f),c.appendChild(d),c};i=b.map(function(a){var b=a.name.match(/:\/\/(.[^/]+)([^?]*)\??(.*)/),c=b[2].split("/").pop(),d=c.substr((Math.max(0,c.lastIndexOf("."))||1/0)+1),e={name:a.name,domain:b[1],initiatorType:a.initiatorType||d||"SourceMap or Not Defined",fileExtension:d||"XHR or Not Defined",loadtime:a.duration,isLocalDomain:b[1]===location.host};return a.requestStart&&(e.requestStartDelay=a.requestStart-a.startTime,e.dns=a.domainLookupEnd-a.domainLookupStart,e.tcp=a.connectEnd-a.connectStart,e.ttfb=a.responseStart-a.startTime,e.requestDuration=a.responseStart-a.requestStart),a.secureConnectionStart&&(e.ssl=a.connectEnd-a.secureConnectionStart),e.isLocalDomain?g.push(e):h.push(e),e});var r=o(i.map(function(a){return a.initiatorType}),"fileType"),s=o(i.map(function(a){return a.initiatorType+" "+(a.isLocalDomain?"(local)":"(extenal)")}),"fileType"),t=o(i.map(function(a){return a.domain}),"domain"),u=function(c,d){var e=j("div",{},"float:left; width:28%; margin: 0 5.3333% 0 0;");e.appendChild(j("h1",{text:c},"font:bold 16px/18px sans-serif; margin:1em 0; color:#666;")),e.appendChild(a(d,400)),e.appendChild(j("p",{text:"total requests: ("+b.length+")"})),e.appendChild(q(c,d)),f.appendChild(e)},v=b.length/100;u("Requests by Domain",t.map(function(a){return a.perc=a.count/v,a.label=a.domain,a.id="reqByDomain-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),u("Requests by Type (local/external domain)",s.map(function(a){return a.perc=a.count/v,a.label=a.fileType,a.id="reqByTypeLocEx-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),u("Requests by Type",r.map(function(a){return a.perc=a.count/v,a.label=a.fileType,a.id="reqByType-"+a.label.replace(/[^a-zA-Z]/g,"-"),a}));var w,x={totals:{pageLoadTime:d.loadEventEnd-d.navigationStart,ttfb:d.responseStart-d.navigationStart,domProcessing:d.domComplete-d.domLoading}},y=d.navigationStart;for(var z in d)d.hasOwnProperty(z)&&d[z]&&(x[z]=d[z]-y,w=z.match(/(.*)End$/),w&&d[w[1]+"Start"]&&(x.totals[w[1]]=d[z]-d[w[1]+"Start"]));var A=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}};x.blocks=[A("unload",x.unloadEventStart,x.unloadEventEnd,"#909"),A("redirect",x.redirectStart,x.redirectEnd,"#009"),A("App cache",x.fetchStart,x.domainLookupStart,"#099"),A("DNS",x.domainLookupStart,x.domainLookupEnd,"#090"),A("TCP",x.connectStart,x.connectEnd,"#990"),A("Request",x.requestStart,x.responseStart,"#c90"),A("Response",x.responseStart,x.responseEnd,"#6c0"),A("DOM Processing",x.domLoading,x.domComplete,"#9cc"),A("domContentLoaded Event",x.domContentLoadedEventStart,x.domContentLoadedEventEnd,"#c33"),A("Onload Event",x.loadEventStart,x.loadEventEnd,"#cf3")],x.secureConnectionStart&&x.blocks.push(A("SSL",x.connectStart,x.secureConnectionStart,"#990"));var B=function(){for(var a=j("div",{},"float:left; width:100%; margin: 25px 0;"),b=k("svg:svg",{width:"100%",height:25*x.blocks.length+"px",fill:"#ccc"}),c=k("g",{width:"100%"}),d=k("g",{width:"100%"}),e=x.totals.pageLoadTime/100,g=function(a,b,c,d,f,g){var h=k("rect",{width:a/e+"%",height:b+"px",x:c/e+"%",y:d+"px",fill:f});return g&&h.appendChild(k("title",{text:g})),h},h=0,i=x.totals.pageLoadTime/1e3,m=100/i;i>=h;h++){var n=l(h+"sec","100%");h>i-.2?(n.setAttribute("x",m*h-.5+"%"),n.setAttribute("text-anchor","end")):n.setAttribute("x",m*h+.5+"%");var o=k("line",{x1:m*h+"%",y1:"0px",x2:m*h+"%",y2:"100%"},"stroke:#ccc; stroke-width:1");d.appendChild(o),d.appendChild(n)}b.appendChild(d);var p=x.blocks.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)});p.unshift(A("total",0,x.totals.pageLoadTime,"#ccc")),p.forEach(function(a,d){var f=a.total||1,h=25*d;b.appendChild(g(f,25,a.start||.001,h,a.colour,a.name+" ("+a.total+"ms)"));var i=l(a.name+" ("+a.total+"ms)",h+18+"px");(a.total||1)/e>10?(i.setAttribute("x",(a.start||.001)/e+.5+"%"),i.setAttribute("width",f/e+"%")):(a.start||.001)/e+f/e<80?i.setAttribute("x",(a.start||.001)/e+f/e+.5+"%"):(i.setAttribute("x",(a.start||.001)/e-.5+"%"),i.setAttribute("text-anchor","end")),c.appendChild(i)}),b.appendChild(c),a.appendChild(j("h1",{text:"Navigation Timing"},"font:bold 16px/18px sans-serif; margin:1em 0; color:#666;")),a.appendChild(b),f.insertBefore(a,f.firstChild)};B(),document.body.appendChild(e),console.log("\n\n\nNavigation Timeline:"),console.table(x.blocks),console.log("\n\n\nAll times (in ms since navigationStart):"),console.log(x)}();