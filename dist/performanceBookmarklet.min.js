/*https://github.com/nurun/performance-bookmarklet by Michael Mrowetz @MicMro*/
!function(){var a,b,c,d,e,f,g,h=[];if(window.performance&&void 0!==window.performance.getEntriesByType)a=window.performance.getEntriesByType("resource"),c=window.performance.getEntriesByType("mark");else{if(!window.performance||void 0===window.performance.webkitGetEntriesByType)return void alert("Oups, looks like this browser does not support the Resource Timing API\ncheck http://caniuse.com/#feat=resource-timing to see the ones supporting it \n\n");a=window.performance.webkitGetEntriesByType("resource"),c=window.performance.webkitGetEntriesByType("mark")}window.performance.timing?d=window.performance.timing:alert("Oups, looks like this browser does not support performance timing"),a=a.filter(function(a){return!a.name.match(/http[s]?\:\/\/nurun.github.io\/performance-bookmarklet\/.*/)}),b=a.map(function(a){var b=a.name.match(/:\/\/(.[^/]+)([^?]*)\??(.*)/),c=b[2].split("/").pop(),d=c.substr((Math.max(0,c.lastIndexOf("."))||1/0)+1),e={name:a.name,domain:b[1],initiatorType:a.initiatorType||d||"SourceMap or Not Defined",fileExtension:d||"XHR or Not Defined",loadtime:a.duration,isLocalDomain:b[1]===location.host};for(var f in a)a.hasOwnProperty(f)&&(e[f]=a[f]);return a.requestStart&&(e.requestStartDelay=a.requestStart-a.startTime,e.dns=a.domainLookupEnd-a.domainLookupStart,e.tcp=a.connectEnd-a.connectStart,e.ttfb=a.responseStart-a.startTime,e.requestDuration=a.responseStart-a.requestStart),a.secureConnectionStart&&(e.ssl=a.connectEnd-a.secureConnectionStart),e}),h.push({name:"All loaded ressources",data:b,columns:["name","domain","initiatorType","fileExtension","loadtime","isLocalDomain","requestStartDelay","dns","tcp","ttfb","requestDuration","ssl"]});var i=function(a,b,c){b=b||{};var d=document.createElement(a);for(var e in b)"text"!=e&&(d[e]=b[e]);return d.textContent=b.text,d.style.cssText=c||"",d},j=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);b=b||{};for(var e in b)"text"!=e&&d.setAttributeNS(null,e,b[e]);return d.textContent=b.text,d.style.cssText=c||"",d},k=function(a,b,c){return j("text",{fill:"#111",y:b,text:a},(c||"")+" text-shadow:0 0 2px #fff;")},l=function(a){var b=j("svg:svg",{},"visibility:hidden;");b.appendChild(a),e.body.appendChild(b);var c=a.getBBox().width;return b.parentNode.removeChild(b),c},m=function(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b},n=function(a,b){var c={},d=[];a.forEach(function(a){c[a]=c[a]?c[a]+1:1});for(var e in c)obj={},obj[b||"key"]=e,obj.count=c[e],d.push(obj);return d.sort(function(a,b){return a.count<b.count?1:-1})};if(document.getElementById("perfbook-iframe"))e=document.getElementById("perfbook-iframe").contentWindow.document,f=e.getElementById("perfbook-holder");else{var o=i("iframe",{id:"perfbook-iframe"},"position:absolute; top:0; left:0; right:0; z-index: 9999; width:100%;");document.body.appendChild(o),e=o.contentWindow.document}if(f)for(g=e.getElementById("perfbook-content");g.firstChild;)g.removeChild(g.firstChild);else{f=i("div",{id:"perfbook-holder"},"position:absolute; top:0; left:0; z-index: 9999; font:normal 12px/18px sans-serif; width:100%; padding:1em 1em 3em; box-sizing:border-box; background:rgba(255, 255, 255, 1);"),g=i("div",{id:"perfbook-content"},"position:relative;");var p=i("button",{"class":"perfbook-close",text:"close"},"position:absolute; top:0; right:0; padding:1em 0.5em; z-index:1; background:transparent; border:0;");p.addEventListener("click",function(){f.parentNode.removeChild(f)}),f.appendChild(p),f.appendChild(g)}!function(){var a={pageLoadTime:d.loadEventEnd-d.navigationStart,output:[]},b=d.navigationStart;for(var e in d)d.hasOwnProperty(e)&&d[e]&&(a[e]=d[e]-b,a.output.push({name:e,"time (ms)":d[e]-b}));a.output.sort(function(a,b){return(a["time (ms)"]||0)-(b["time (ms)"]||0)});var f=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}};a.blocks=[f("total",0,a.pageLoadTime,"#ccc"),f("ttfb",a.navigationStart,a.responseStart,"#bbb"),f("unload",a.unloadEventStart,a.unloadEventEnd,"#909"),f("redirect",a.redirectStart,a.redirectEnd,"#009"),f("App cache",a.fetchStart,a.domainLookupStart,"#099"),f("DNS",a.domainLookupStart,a.domainLookupEnd,"#090"),f("TCP",a.connectStart,a.connectEnd,"#990"),f("Request",a.requestStart,a.responseStart,"#c90"),f("Response",a.responseStart,a.responseEnd,"#6c0"),f("DOM Processing",a.domLoading,a.domComplete,"#9cc"),f("domContentLoaded Event",a.domContentLoadedEventStart,a.domContentLoadedEventEnd,"#c33"),f("Onload Event",a.loadEventStart,a.loadEventEnd,"#cf3")],a.secureConnectionStart&&a.blocks.push(f("SSL",a.connectStart,a.secureConnectionStart,"#990"));var m=function(){var b=a.pageLoadTime/100,d=a.blocks.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),e=c.length>0?c.reduce(function(a,b){return Math.max("number"==typeof a?a:0,l(k(b.name,"0")))}):0,f=25*(d.length+2),h=f+e+25,m=i("div",{},"float:left; width:100%; margin: 25px 0;"),n=j("svg:svg",{width:"100%",height:h,fill:"#ccc"}),o=j("g",{width:"100%","class":"labels"}),p=function(a,c,d,e,f,g){var h=j("rect",{width:a/b+"%",height:c,x:d/b+"%",y:e,fill:f});return g&&h.appendChild(j("title",{text:g})),h},q=function(){for(var b=j("g",{width:"100%","class":"time-scale"}),c=0,d=a.pageLoadTime/1e3,e=100/d;d>=c;c++){var g=k(c+"sec",f,"font-weight:bold;");c>d-.2?(g.setAttribute("x",e*c-.5+"%"),g.setAttribute("text-anchor","end")):g.setAttribute("x",e*c+.5+"%");var h=j("line",{x1:e*c+"%",y1:"0",x2:e*c+"%",y2:f},"stroke:#0cc; stroke-width:1;");b.appendChild(h),b.appendChild(g)}return b},r=function(){var a=j("g",{width:"100%",transform:"scale(1, 1)","class":"marker-holder"}),d="#aac";return c.forEach(function(e,g){var h=j("g",{}),i=j("g",{},"stroke:"+d+"; stroke-width:1"),l=e.startTime/b;e.x=l;var m=k(e.name,f+25);m.setAttribute("writing-mode","tb"),m.setAttribute("x",l+"%"),m.setAttribute("stroke",""),i.appendChild(j("line",{x1:l+"%",y1:"0px",x2:l+"%",y2:f})),c[g-1]&&e.x-c[g-1].x<1&&(m.setAttribute("x",c[g-1].x+1+"%"),e.x=c[g-1].x+1),i.appendChild(j("line",{x1:l+"%",y1:f,x2:e.x+"%",y2:f+23})),m.addEventListener("mouseover",function(){i.style.stroke="#009",i.style.strokeWidth="2",h.parentNode.appendChild(h)}),m.addEventListener("mouseout",function(){i.style.strokeWidth="1",i.style.stroke=d}),h.appendChild(j("title",{text:e.name+" ("+Math.round(e.startTime)+"ms)"})),h.appendChild(i),h.appendChild(m),a.appendChild(h)}),a};n.appendChild(q()),n.appendChild(r()),d.forEach(function(a,c){var d=a.total||1,e=25*c;n.appendChild(p(d,25,a.start||.001,e,a.colour,a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)"));var f=k(a.name+" ("+a.total+"ms)",e+18);(a.total||1)/b>10?(f.setAttribute("x",(a.start||.001)/b+.5+"%"),f.setAttribute("width",d/b+"%")):(a.start||.001)/b+d/b<80?f.setAttribute("x",(a.start||.001)/b+d/b+.5+"%"):(f.setAttribute("x",(a.start||.001)/b-.5+"%"),f.setAttribute("text-anchor","end")),o.appendChild(f)}),n.appendChild(o),m.appendChild(i("h1",{text:"Navigation Timing"},"font:bold 16px/18px sans-serif; margin:1em 0; color:#666;")),m.appendChild(n),g.appendChild(m)};m(),h=h.concat([{name:"Navigation Timeline",data:a.blocks,columns:["name","start","end","total"]},{name:"Navigation Events",data:a.output},{name:"Marks",data:c,columns:["name","startTime","duration"]}])}(),function(){function c(a,b){var c=j("svg:svg",{width:"100%",height:"100%",viewBox:"0 0 "+b+" "+b}),d=2*Math.PI/100,f=0,g=function(a,b,c,g,h){var i=b/2,m=f+(c*d-.001),n=f+(c/2*d-.001),o=i+i*Math.sin(f),p=i-i*Math.cos(f),q=i+i*Math.sin(m),r=i-i*Math.cos(m),s=i+.85*i*Math.sin(n),t=i-.85*i*Math.cos(n),u=m-f>Math.PI?1:0,v="M "+i+","+i+" L "+o+","+p+" A "+i+","+i+" 0 "+u+" 1 "+q+","+r+" Z",w=j("path",{id:a,d:v,fill:h});if(w.appendChild(j("title",{text:g})),w.addEventListener("mouseover",function(a){a.target.style.opacity="0.5",e.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="#ccc"}),w.addEventListener("mouseout",function(a){a.target.style.opacity="1",e.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="transparent"}),f=m,c>10){var x=k(g,t);return n<Math.PI?x.setAttribute("x",s-l(x)):x.setAttribute("x",s),{path:w,wedgeLabel:x}}return{path:w}},h=j("g",{},"pointer-events:none; font-weight:bold;"),i=j("g");return a.forEach(function(a){var c=g(a.id,b,a.perc,a.label+" ("+a.count+")",m());i.appendChild(c.path),c.wedgeLabel&&h.appendChild(c.wedgeLabel)}),i.appendChild(j("circle",{cx:b/2,cy:b/2,r:.05*b,fill:"#fff"})),c.appendChild(i),c.appendChild(h),c}var d=function(a,b){var c=i("div",{},"float:left; width:100%; overflow-x:auto"),d=i("table",{},"float:left; width:100%;"),e=i("thead"),f=i("tbody");return e.appendChild(i("th",{text:a},"text-align: left; padding:0 0.5em 0 0;")),e.appendChild(i("th",{text:"Requests"},"text-align: left; padding:0 0.5em 0 0;")),e.appendChild(i("th",{text:"Percentage"},"text-align: left; padding:0 0.5em 0 0;")),d.appendChild(e),b.forEach(function(a){var b=i("tr",{id:a.id+"-table"});b.appendChild(i("td",{text:a.label})),b.appendChild(i("td",{text:a.count})),b.appendChild(i("td",{text:a.perc.toPrecision(2)+"%"})),f.appendChild(b)}),d.appendChild(f),c.appendChild(d),c};fileExtensionCounts=n(b.map(function(a){return a.initiatorType}),"fileType"),fileExtensionCountLocalExt=n(b.map(function(a){return a.initiatorType+" "+(a.isLocalDomain?"(local)":"(extenal)")}),"fileType"),requestsByDomain=n(b.map(function(a){return a.domain}),"domain");var f=function(b,e){var f=i("div",{},"float:left; width:28%; margin: 0 5.3333% 0 0;");f.appendChild(i("h1",{text:b},"font:bold 16px/18px sans-serif; margin:1em 0; color:#666;")),f.appendChild(c(e,400)),f.appendChild(i("p",{text:"total requests: ("+a.length+")"})),f.appendChild(d(b,e)),g.appendChild(f)},o=a.length/100;f("Requests by Domain",requestsByDomain.map(function(a){return a.perc=a.count/o,a.label=a.domain,a.id="reqByDomain-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),f("Requests by Type (local/external domain)",fileExtensionCountLocalExt.map(function(a){return a.perc=a.count/o,a.label=a.fileType,a.id="reqByTypeLocEx-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),f("Requests by Type",fileExtensionCounts.map(function(a){return a.perc=a.count/o,a.label=a.fileType,a.id="reqByType-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),h=h.concat([{name:"Requests by domain",data:requestsByDomain},{name:"File type count (local / external)",data:fileExtensionCounts},{name:"File type count",data:fileExtensionCountLocalExt}])}(),function(){var a={pageLoadTime:d.loadEventEnd-d.responseStart,lastResponseEnd:d.loadEventEnd-d.responseStart};for(var e in d)d.hasOwnProperty(e)&&d[e]&&(a[e]=d[e]-d.navigationStart);var f=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}},h=function(a,b,c,d,e,f){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d,segments:e,rawResource:f}};a.blocks=[h("Navigation API total",0,a.loadEventEnd,"#ccc",[f("ttfb",a.navigationStart,a.responseStart,"#bbb"),f("unload",a.unloadEventStart,a.unloadEventEnd,"#909"),f("redirect",a.redirectStart,a.redirectEnd,"#009"),f("App cache",a.fetchStart,a.domainLookupStart,"#099"),f("DNS",a.domainLookupStart,a.domainLookupEnd,"#090"),f("TCP",a.connectStart,a.connectEnd,"#990"),f("Request",a.requestStart,a.responseStart,"#c90"),f("Response",a.responseStart,a.responseEnd,"#6c0"),f("DOM Processing",a.domLoading,a.domComplete,"#9cc"),f("domContentLoaded Event",a.domContentLoadedEventStart,a.domContentLoadedEventEnd,"#c33"),f("Onload Event",a.loadEventStart,a.loadEventEnd,"#cf3")])],b.forEach(function(b){var c=[f("redirect",b.redirectStart,b.redirectEnd,"#030"),f("domainLookup",b.domainLookupStart,b.domainLookupEnd,"#060"),f("connect",b.connectStart,b.connectEnd,"#090"),f("secureConnect",b.secureConnectionStart,b.connectEnd,"#0c0"),f("requestToResponseStart",b.requestStart,b.responseStart,"#0f0"),f("response",b.responseStart,b.responseEnd,"#0fc")],d="#d6d6d7";switch(b.initiatorType){case"css":d="#c5efaf";break;case"iframe":d="#85b3f2";break;case"img":d="#c98dfd";break;case"script":d="#feb06a";break;case"link":d="#6c7385";break;case"xmlhttprequest":d="#efef70"}a.blocks.push(h(b.name,Math.round(b.startTime),Math.round(b.responseEnd),d,c,b)),a.lastResponseEnd=Math.max(a.lastResponseEnd,b.responseEnd)}),a.loadDuration=Math.round(a.lastResponseEnd);var m=function(a,b){var d=a/100,e=b.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),f=c.length>0?c.reduce(function(a,b){return Math.max("number"==typeof a?a:0,l(k(b.name,"0")))}):0,h=25*(e.length+2),m=h+f+25,n=i("div",{},"float:left; width:100%; margin: 25px 0;"),o=j("svg:svg",{width:"100%",height:m,fill:"#ccc"}),p=j("g",{width:"100%","class":"labels"}),q=function(a,b,c,e,f,g,h){var i,k=j("rect",{width:a/d+"%",height:b-1,x:c/d+"%",y:e,fill:f,"class":h&&h.length>0?"main":"segment"});return g&&k.appendChild(j("title",{text:g})),h&&h.length>0?(i=j("g"),i.appendChild(k),h.forEach(function(a){a.total>0&&a.start&&i.appendChild(q(a.total,8,a.start||.001,e,a.colour,a.name+" ("+Math.round(a.start)+"ms - "+Math.round(a.end)+"ms | total: "+Math.round(a.total)+"ms)"))}),i):k},r=function(){for(var b=j("g",{width:"100%","class":"time-scale"}),c=0,d=a/1e3,e=100/d;d>=c;c++){var f=k(c+"sec",h,"font-weight:bold;");c>d-.2?(f.setAttribute("x",e*c-.5+"%"),f.setAttribute("text-anchor","end")):f.setAttribute("x",e*c+.5+"%");var g=j("line",{x1:e*c+"%",y1:"0",x2:e*c+"%",y2:h},"stroke:#0cc; stroke-width:1;");b.appendChild(g),b.appendChild(f)}return b},s=function(){var a=j("g",{width:"100%",transform:"scale(1, 1)","class":"marker-holder"}),b="#aac";return c.forEach(function(e,f){var g=j("g",{}),i=j("g",{},"stroke:"+b+"; stroke-width:1"),l=e.startTime/d;e.x=l;var m=k(e.name,h+25);m.setAttribute("writing-mode","tb"),m.setAttribute("x",l+"%"),m.setAttribute("stroke",""),i.appendChild(j("line",{x1:l+"%",y1:"0px",x2:l+"%",y2:h})),c[f-1]&&e.x-c[f-1].x<1&&(m.setAttribute("x",c[f-1].x+1+"%"),e.x=c[f-1].x+1),i.appendChild(j("line",{x1:l+"%",y1:h,x2:e.x+"%",y2:h+23})),m.addEventListener("mouseover",function(){i.style.stroke="#009",i.style.strokeWidth="2",g.parentNode.appendChild(g)}),m.addEventListener("mouseout",function(){i.style.strokeWidth="1",i.style.stroke=b}),g.appendChild(j("title",{text:e.name+" ("+Math.round(e.startTime)+"ms)"})),g.appendChild(i),g.appendChild(m),a.appendChild(g)}),a};o.appendChild(r()),o.appendChild(s()),e.forEach(function(a,b){var c=a.total||1,e=25*b;o.appendChild(q(c,25,a.start||.001,e,a.colour,a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)",a.segments));var f=k(a.name+" ("+a.total+"ms)",e+20);(a.total||1)/d>10&&l(f)<200?(f.setAttribute("x",(a.start||.001)/d+.5+"%"),f.setAttribute("width",c/d+"%")):(a.start||.001)/d+c/d<80?f.setAttribute("x",(a.start||.001)/d+c/d+.5+"%"):(f.setAttribute("x",(a.start||.001)/d-.5+"%"),f.setAttribute("text-anchor","end")),p.appendChild(f)}),o.appendChild(p),n.appendChild(i("h1",{text:"Resource Timing"},"font:bold 16px/18px sans-serif; margin:1em 0; color:#666;")),n.appendChild(o),g.appendChild(n)};m(a.loadDuration,a.blocks)}(),window.outputHolder=f,e.body.appendChild(f),document.getElementById("perfbook-iframe").style.height=f.clientHeight+"px",h.forEach(function(a){a.data.length>0&&console.table&&(console.log("\n\n\n"+a.name+":"),console.table(a.data,a.columns))})}();