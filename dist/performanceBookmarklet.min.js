/*https://github.com/nurun/performance-bookmarklet by Michael Mrowetz @MicMro*/
!function(){"use strict";var a,b,c,d,e,f,g,h,i,j="body {overflow: hidden; background: #fff; font:normal 12px/18px sans-serif; color:#333;} * {box-sizing:border-box;} svg {font:normal 12px/18px sans-serif;} #perfbook-holder {overflow: hidden; width:100%; padding:1em 2em 3em;} #perfbook-content {position:relative;} .perfbook-close {position:absolute; top:0; right:0; padding:1em; z-index:1; background:transparent; border:0; cursor:pointer;} .full-width {width:100%;} h1 {font:bold 18px/18px sans-serif; margin:1em 0; color:#666;} .text-right {text-align: right;} .text-left {text-align: left;} .tiles-holder {margin: 2em -18px 1em 0; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-flex-flow: row wrap; flex-flow: row wrap; } .summary-tile { flex-grow: 1; width:250px; background:#ddd; padding: 1em; margin:0 18px 1em 0; color:#666; text-align:center;} .summary-tile dt {font-weight:bold; font-size:16px; display:block; line-height:1.2em; min-height:2.9em; padding:0 0 0.5em;} .summary-tile dd {font-weight:bold; line-height:60px; margin:0;} .summary-tile-appendix {float:left; clear:both; width:100%; font-size:10px; line-height:1.1em; color:#666;} .summary-tile-appendix dt {float:left; clear:both;} .summary-tile-appendix dd {float:left; margin:0 0 0 1em;} .pie-charts-holder {margin: 0 -72px 0 0; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-flex-flow: row wrap; flex-flow: row wrap;} .pie-chart-holder {flex-grow: 1; width:350px; max-width: 600px; margin: 0 72px 0 0;} .pie-chart-holder h1 {min-height:2em;} .pie-chart {width:100%;} .table-holder {overflow-x:auto} .table-holder table {float:left; width:100%; font-size:12px; line-height:18px;} .table-holder th { padding:0 0.5em 0 0;} .table-holder td {padding:0 0.5em 0 0;} .water-fall-holder {margin: 25px 0; fill:#ccc;} .water-fall-chart {width:100%; background:#f0f5f0;} .water-fall-chart .marker-holder {width:100%;} .water-fall-chart .line-holder {stroke-width:1; stroke: #a971c5; stroke-opacity:0.5;} .water-fall-chart .line-holder.active {stroke: #69009e; stroke-width:2; stroke-opacity:1;} .water-fall-chart .labels {width:100%;} .water-fall-chart .labels .inner-label {pointer-events: none;} .water-fall-chart .time-block.active {opacity: 0.8;} .water-fall-chart .line-end, .water-fall-chart .line-start {display: none; stroke-width:1; stroke-opacity:0.5; stroke: #000;} .water-fall-chart .line-end.active, .water-fall-chart .line-start.active {display: block;} .time-scale line {stroke:#0cc; stroke-width:1;} .time-scale text {font-weight:bold;} .navigation-timing {} .legends-group { display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-flex-flow: row wrap; flex-flow: row wrap; } .legends-group .legend-holder { flex-grow: 1; width:250px; padding:0 1em 1em; } .legends-group .legend-holder h4 { margin: 0; padding: 0; } .legend dt {float: left; clear: left; padding: 0 0 0.5em;} .legend dd {float: left; display: inline-block; margin: 0 1em; line-height: 1em;} .legend .colorBoxHolder span {display: inline-block; width: 15px; height: 1em;} .resource-timing .chart-holder {} ",k=[];if("about:"!==location.protocol){if(window.performance&&void 0!==window.performance.getEntriesByType)a=window.performance.getEntriesByType("resource"),c=window.performance.getEntriesByType("mark"),d=window.performance.getEntriesByType("measure");else{if(!window.performance||void 0===window.performance.webkitGetEntriesByType)return void alert("Oups, looks like this browser does not support the Resource Timing API\ncheck http://caniuse.com/#feat=resource-timing to see the ones supporting it \n\n");a=window.performance.webkitGetEntriesByType("resource"),c=window.performance.webkitGetEntriesByType("mark"),d=window.performance.webkitGetEntriesByType("measure")}if(!window.performance.timing)return void alert("Oups, looks like this browser does not support performance timing");if(e=window.performance.timing,e.loadEventEnd-e.navigationStart<0)return void alert("Page is still loading - please try again when page is loaded.");var l=function(a,b){if(a)switch(a){case"jpg":case"jpeg":case"png":case"gif":case"webp":case"svg":case"ico":return"image";case"js":return"js";case"css":return"css";case"html":return"html";case"woff":case"woff2":case"ttf":case"eot":case"otf":return"font";case"swf":return"flash";case"map":return"source-map"}if(b)switch(b){case"xmlhttprequest":return"ajax";case"img":return"image";case"script":return"js";case"internal":case"iframe":return"html";default:return"other"}return b};b=a.filter(function(a){return!a.name.match(/http[s]?\:\/\/nurun.github.io\/performance-bookmarklet\/.*/)}).map(function(a){var b,c,d,e=0===a.name.indexOf("http");e?(b=a.name.match(/:\/\/(.[^/]+)([^?]*)\??(.*)/),c=b[2].split("/").pop(),d=c.substr((Math.max(0,c.lastIndexOf("."))||1/0)+1)):(b=["",location.host],d=a.name.split(":")[0]);var f={name:a.name,domain:b[1],initiatorType:a.initiatorType||d||"SourceMap or Not Defined",fileExtension:d||"XHR or Not Defined",loadtime:a.duration,fileType:l(d,a.initiatorType),isRequestToHost:b[1]===location.host};for(var g in a)"function"!=typeof a[g]&&(f[g]=a[g]);return a.requestStart&&(f.requestStartDelay=a.requestStart-a.startTime,f.dns=a.domainLookupEnd-a.domainLookupStart,f.tcp=a.connectEnd-a.connectStart,f.ttfb=a.responseStart-a.startTime,f.requestDuration=a.responseStart-a.requestStart),a.secureConnectionStart&&(f.ssl=a.connectEnd-a.secureConnectionStart),f}),k.push({name:"All loaded resources",data:b,columns:["name","domain","initiatorType","fileType","fileExtension","loadtime","isRequestToHost","requestStartDelay","dns","tcp","ttfb","requestDuration","ssl"]});var m=function(a){return document.createTextNode(a)},n=function(a,b,c){b=b||{};var d=document.createElement(a);for(var e in b)"text"!=e&&(d[e]=b[e]);return b.text?d.textContent=b.text:b.childElement&&("object"==typeof b.childElement?b.childElement instanceof NodeList?Array.prototype.slice.call(b.childElement,0).forEach(function(a){d.appendChild(a)}):d.appendChild(b.childElement):d.appendChild(m(b.childElement))),b["class"]&&(d.className=b["class"]),d.style.cssText=c||"",d},o=function(a,b){var c=document.createElement("div");return"object"==typeof a?c.appendChild(a):"string"==typeof a&&c.appendChild(m(a)),"object"==typeof b?c.appendChild(b):"string"==typeof b&&c.appendChild(m(b)),c.childNodes},p=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);b=b||{};for(var e in b)"text"!=e&&d.setAttributeNS(null,e,b[e]);return d.textContent=b.text||"",d.style.cssText=c||"",d},q=function(a,b,c){return p("text",{fill:"#111",y:b,text:a},(c||"")+" text-shadow:0 0 4px #fff;")},r=function(a){var b=p("svg:svg",{},"visibility:hidden;");b.appendChild(a),g.body.appendChild(b);var c=a.getBBox().width;return b.parentNode.removeChild(b),c},s=function(a,b,c){for(var d=[a||"0123456789ABCDEF",b||"0123456789ABCDEF",c||"0123456789ABCDEF"],e="#",f=0,g=0;6>g;g++)f=Math.floor(g/2),e+=d[f].split("")[Math.floor(Math.random()*d[f].length)];return e},t=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},u=function(a,b){var c=b||"#bebebe";switch(a){case"css":c="#afd899";break;case"iframe":c="#85b3f2";break;case"img":c="#bc9dd6";break;case"script":c="#e7bd8c";break;case"link":c="#89afe6";break;case"swf":c="#4db3ba";break;case"font":c="#e96859";break;case"xmlhttprequest":c="#e7d98c"}return c},v=function(a,b){var c=b||"#bebebe";switch(a){case"css":c="#afd899";break;case"html":c="#85b3f2";break;case"image":c="#bc9dd6";break;case"js":c="#e7bd8c";break;case"link":c="#89afe6";break;case"swf":c="#4db3ba";break;case"font":c="#e96859";break;case"ajax":c="#e7d98c"}return c},w=function(a,b){var c,d={},e=[];a.forEach(function(a){d[a]=d[a]?d[a]+1:1});for(var f in d)c={},c[b||"key"]=f,c.count=d[f],e.push(c);return e.sort(function(a,b){return a.count<b.count?1:-1})},x=function(a,b){var c;document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0)):(c=document.createEventObject(),c.eventType=b),c.eventName=b,document.createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)},y=function(a,b){return a.classList?a.classList.add(b):a.setAttribute("class",a.getAttribute("class")+" "+b),a},z=function(a,b){return a.classList?a.classList.remove(b):a.setAttribute("class",a.getAttribute("class").replace(new RegExp("(\\s|^)"+b+"(\\s|$)","g"),"$2")),a},A=function(){var a=!1,b=[],c=function(){a=!0,window.removeEventListener("iFrameLoaded",c,!1),b.forEach(function(a){a()})};return window.addEventListener("iFrameLoaded",c,!1),function(c){a?c():b.push(c)}}();f=document.getElementById("perfbook-iframe"),f?(g=f.contentWindow.document,h=g.getElementById("perfbook-holder"),x(window,"iFrameLoaded")):(f=n("iframe",{id:"perfbook-iframe",onload:function(){g=f.contentWindow.document;var a=n("style",{type:"text/css",text:j});g.head.appendChild(a),x(window,"iFrameLoaded")}},"position:absolute; top:1%; right:1%; margin-bottom:1em; left:1%; z-index: 9999; width:98%; z-index: 9999; border:0; box-shadow:0 0 25px 0 rgba(0,0,0,0.5); background:#fff;"),document.body.appendChild(f)),A(function(){if(h)for(i=g.getElementById("perfbook-content");i.firstChild;)i.removeChild(i.firstChild);else{h=n("div",{id:"perfbook-holder"}),i=n("div",{id:"perfbook-content"});var a=n("button",{"class":"perfbook-close",text:"close"});a.addEventListener("click",function(){f.parentNode.removeChild(f)}),h.appendChild(a),h.appendChild(i)}}),A(function(){var a,c,d,f,g,h,j,k,l,p,q,r;a=b.filter(function(a){return 0===a.name.indexOf("http")&&!a.name.match(/js.map$/)}),c=w(a.map(function(a){return a.domain}),"domain"),d=a.filter(function(a){return a.domain.split(".").slice(-2).join(".")===location.host.split(".").slice(-2).join(".")}).length,f=a.filter(function(a){return!t(a.domain,document.domain)}).length,g=a.filter(function(a){return a.domain===location.host}).length,h=c.filter(function(a){return t(a.domain,location.host.split(".").slice(-2).join("."))&&a.domain!==location.host}).length,b.length>0&&(j=b.filter(function(a){return a.name!==location.href}).sort(function(a,b){return b.duration-a.duration}),k=Math.floor(j.reduceRight(function(a,b){return"number"!=typeof a?a.duration+b.duration:a+b.duration})/j.length)),l=function(a,b,c){c=c||60;var d=n("dl",{"class":"summary-tile"});return d.appendChild(n("dt",{childElement:a})),d.appendChild(n("dd",{childElement:b},"font-size:"+c+"px;")),d},p=function(a,b,c){a.appendChild(n("dt",{childElement:b})),a.appendChild(n("dd",{text:c}))},q=n("div",{"class":"tiles-holder"}),[l("Requests",a.length||"0"),l("Domains",c.length||"0"),l(o("Subdomains of ",n("abbr",{title:"Top Level Domain",text:"TLD"})),h||"0"),l(o("Requests to ",n("span",{title:location.host,text:"Host"})),g||"0"),l(o(n("abbr",{title:"Top Level Domain",text:"TLD"}),"& Subdomain Requests"),d||"0"),l("Total",e.loadEventEnd-e.navigationStart+"ms",40),l("Time to First Byte",e.responseStart-e.navigationStart+"ms",40),l(n("span",{title:"domLoading to domContentLoadedEventStart",text:"DOM Content Loading"}),e.domContentLoadedEventStart-e.domLoading+"ms",40),l(n("span",{title:"domLoading to loadEventStart",text:"DOM Processing"}),e.domComplete-e.domLoading+"ms",40)].forEach(function(a){q.appendChild(a)}),b.length>0&&(q.appendChild(l(n("span",{title:j[0].name,text:"Slowest Call"}),n("span",{title:j[0].name,text:Math.floor(j[0].duration)+"ms"}),40)),q.appendChild(l("Average Call",k+"ms",40))),r=n("dl",{"class":"summary-tile-appendix"}),p(r,n("abbr",{title:"Top Level Domain",text:"TLD"},location.host.split(".").slice(-2).join("."))),p(r,m("Host:"),location.host),p(r,m("document.domain:"),document.domain),q.appendChild(r),i.appendChild(q)}),A(function(){var a={pageLoadTime:e.loadEventEnd-e.navigationStart,output:[]},b=e.navigationStart;for(var f in e)e[f]&&"number"==typeof e[f]&&(a[f]=e[f]-b,a.output.push({name:f,"time (ms)":e[f]-b}));a.output.sort(function(a,b){return(a["time (ms)"]||0)-(b["time (ms)"]||0)});var g=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}};a.blocks=[g("Total",0,a.pageLoadTime,"#ccc"),g("Unload",a.unloadEventStart,a.unloadEventEnd,"#909"),g("Redirect ("+performance.navigation.redirectCount+"x)",a.redirectStart,a.redirectEnd,"#ffff60"),g("App cache",a.fetchStart,a.domainLookupStart,"#1f831f"),g("DNS",a.domainLookupStart,a.domainLookupEnd,"#1f7c83"),g("TCP",a.connectStart,a.connectEnd,"#e58226"),g("Timer to First Byte",a.requestStart,a.responseStart,"#1fe11f"),g("Response",a.responseStart,a.responseEnd,"#1977dd"),g("DOM Processing",a.domLoading,a.domComplete,"#9cc"),g("domContentLoaded Event",a.domContentLoadedEventStart,a.domContentLoadedEventEnd,"#d888df"),g("onload Event",a.loadEventStart,a.loadEventEnd,"#c0c0ff")],a.secureConnectionStart&&a.blocks.push(g("SSL",a.connectStart,a.secureConnectionStart,"#c141cd")),a.msFirstPaint&&a.blocks.push(g("msFirstPaint Event",a.msFirstPaint,a.msFirstPaint,"#8FBC83")),a.domInteractive&&a.blocks.push(g("domInteractive Event",a.domInteractive,a.domInteractive,"#d888df")),!a.redirectEnd&&!a.redirectStart&&a.fetchStart>a.navigationStart&&a.blocks.push(g("Cross-Domain Redirect (and/or other Delay)",a.navigationStart,a.fetchStart,"#ffff60")),a.blocks.push(g("Network/Server",a.navigationStart,a.responseStart,"#8cd18c")),d.forEach(function(b){a.blocks.push(g("measure:"+b.name,Math.round(b.startTime),Math.round(b.startTime+b.duration),"#f00"))});var h=function(){var b=a.pageLoadTime/100,d=a.blocks.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),e=c.length>0?c.reduce(function(a,b){return Math.max("number"==typeof a?a:0,r(q(b.name,"0")))}):0,f=25*(d.length+1),g=f+e+35,h=n("div",{"class":"navigation-timing water-fall-holder chart-holder"}),j=p("svg:svg",{height:Math.floor(g),"class":"water-fall-chart"}),k=p("g",{"class":"labels"}),l=p("line",{x1:"0",y1:"0",x2:"0",y2:f,"class":"line-end"}),m=p("line",{x1:"0",y1:"0",x2:"0",y2:f,"class":"line-start"}),o=function(a){var b=a.target;y(b,"active");var c=b.x.baseVal.valueInSpecifiedUnits+b.width.baseVal.valueInSpecifiedUnits+"%",d=b.x.baseVal.valueInSpecifiedUnits+"%";l.x1.baseVal.valueAsString=c,l.x2.baseVal.valueAsString=c,m.x1.baseVal.valueAsString=d,m.x2.baseVal.valueAsString=d,y(l,"active"),y(m,"active"),b.parentNode.appendChild(l),b.parentNode.appendChild(m)},s=function(a){z(a.target,"active"),z(l,"active"),z(m,"active")},t=function(a,c,d,e,f,g){var h=p("rect",{width:a/b+"%",height:c,x:d/b+"%",y:e,fill:f,"class":"time-block"});return g&&h.appendChild(p("title",{text:g})),h.addEventListener("mouseenter",o),h.addEventListener("mouseleave",s),h},u=function(){for(var b=p("g",{"class":"time-scale full-width"}),c=0,d=a.pageLoadTime/1e3,e=100/d;d>=c;c++){var g=q(c+"sec",f);c>d-.2?(g.setAttribute("x",e*c-.5+"%"),g.setAttribute("text-anchor","end")):g.setAttribute("x",e*c+.5+"%");var h=p("line",{x1:e*c+"%",y1:"0",x2:e*c+"%",y2:f});b.appendChild(h),b.appendChild(g)}return b},v=function(){var a=p("g",{transform:"scale(1, 1)","class":"marker-holder"});return c.forEach(function(d,e){var g=p("g",{"class":"mark-holder"}),h=p("g",{"class":"line-holder"}),i=d.startTime/b;d.x=i;var j=q(d.name,f+25);j.setAttribute("writing-mode","tb"),j.setAttribute("x",i+"%"),j.setAttribute("stroke",""),h.appendChild(p("line",{x1:i+"%",y1:"0px",x2:i+"%",y2:f})),c[e-1]&&d.x-c[e-1].x<1&&(j.setAttribute("x",c[e-1].x+1+"%"),d.x=c[e-1].x+1),h.appendChild(p("line",{x1:i+"%",y1:f,x2:d.x+"%",y2:f+23})),g.addEventListener("mouseenter",function(){y(h,"active"),g.parentNode.appendChild(g)}),g.addEventListener("mouseleave",function(){z(h,"active")}),g.appendChild(p("title",{text:d.name+" ("+Math.round(d.startTime)+"ms)"})),g.appendChild(h),g.appendChild(j),a.appendChild(g)}),a};j.appendChild(u()),j.appendChild(v()),d.forEach(function(a,c){var d=a.total||1,e=25*c;j.appendChild(t(d,25,a.start||.001,e,a.colour,a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)"));var f=q(a.name+" ("+a.total+"ms)",e+18);(a.total||1)/b>10?(f.setAttribute("class","inner-label"),f.setAttribute("x",(a.start||.001)/b+.5+"%"),f.setAttribute("width",d/b+"%")):(a.start||.001)/b+d/b<80?f.setAttribute("x",(a.start||.001)/b+d/b+.5+"%"):(f.setAttribute("x",(a.start||.001)/b-.5+"%"),f.setAttribute("text-anchor","end")),k.appendChild(f)}),j.appendChild(k),h.appendChild(n("h1",{text:"Navigation Timing"})),h.appendChild(j),i.appendChild(h)};h(),k=k.concat([{name:"Navigation Timeline",data:a.blocks,columns:["name","start","end","total"]},{name:"Navigation Events",data:a.output},{name:"Marks",data:c,columns:["name","startTime","duration"]}])}),A(function(){function a(a,b){var c=p("svg:svg",{viewBox:"0 0 "+b+" "+b,"class":"pie-chart"},"max-height:"+(.98*window.innerWidth-64)/3+"px;"),d=2*Math.PI/100,e=0,f=function(a,b,c,f,h){var i=b/2,j=e+(c*d-.001),k=e+(c/2*d-.001),l=i+i*Math.sin(e),m=i-i*Math.cos(e),n=i+i*Math.sin(j),o=i-i*Math.cos(j),s=i+.85*i*Math.sin(k),t=i-.85*i*Math.cos(k),u=j-e>Math.PI?1:0,v="M "+i+","+i+" L "+l+","+m+" A "+i+","+i+" 0 "+u+" 1 "+n+","+o+" Z",w=p("path",{id:a,d:v,fill:h});if(w.appendChild(p("title",{text:f})),w.addEventListener("mouseenter",function(a){a.target.style.opacity="0.5",g.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="#ccc"}),w.addEventListener("mouseleave",function(a){a.target.style.opacity="1",g.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="transparent"}),e=j,c>10){var x=q(f,t);return k<Math.PI?x.setAttribute("x",s-r(x)):x.setAttribute("x",s),{path:w,wedgeLabel:x}}return{path:w}},h=p("g",{},"pointer-events:none; font-weight:bold;"),i=p("g");return a.forEach(function(a){var c=f(a.id,b,a.perc,a.label+" ("+a.count+")",a.colour||s());i.appendChild(c.path),c.wedgeLabel&&h.appendChild(c.wedgeLabel)}),i.appendChild(p("circle",{cx:b/2,cy:b/2,r:.05*b,fill:"#fff"})),c.appendChild(i),c.appendChild(h),c}var c=function(a,b,c){c=c||[{name:"Requests",field:"count"}];var d=n("div",{"class":"table-holder"}),e=n("table",{},""),f=n("thead"),g=n("tbody");return f.appendChild(n("th",{text:a,"class":"text-left"})),c.forEach(function(a){f.appendChild(n("th",{text:a.name,"class":"text-right"}))}),f.appendChild(n("th",{text:"Percentage","class":"text-right"})),e.appendChild(f),b.forEach(function(a){var b=n("tr",{id:a.id+"-table"});b.appendChild(n("td",{text:a.label})),c.forEach(function(c){b.appendChild(n("td",{text:a[c.field],"class":"text-right"}))}),b.appendChild(n("td",{text:a.perc.toPrecision(2)+"%","class":"text-right"})),g.appendChild(b)}),e.appendChild(g),d.appendChild(e),d},d=b.filter(function(a){return 0===a.name.indexOf("http")&&!a.name.match(/js.map$/)}),e=w(d.map(function(a){return a.initiatorType||a.fileExtension}),"initiatorType"),f=w(d.map(function(a){return(a.initiatorType||a.fileExtension)+" "+(a.isRequestToHost?"(host)":"(external)")}),"initiatorType"),h=w(d.map(function(a){return a.domain}),"domain"),j=w(d.map(function(a){return a.fileType}),"fileType");d.forEach(function(a){var b=h.filter(function(b){return b.domain==a.domain})[0]||{};b.durationTotal=(b.durationTotal||0)+a.duration});var l=d.filter(function(a){return a.domain===location.host}).length,m=n("div",{"class":"pie-charts-holder chart-holder"}),o=function(b,e,f,g){var h=n("div",{"class":"pie-chart-holder"});h.appendChild(n("h1",{text:b})),h.appendChild(a(e,400)),h.appendChild(n("p",{text:"Total Requests: "+d.length})),f&&f.length&&f.forEach(function(a){h.appendChild(n("p",{text:a},"margin-top:-1em"))}),h.appendChild(c(b,e,g)),m.appendChild(h)};i.appendChild(m);var t=d.length/100,x="789abcdef",y="789abcdef",z="789abcdef",A=h.map(function(a){return a.perc=a.count/t,a.label=a.domain,a.colour=a.domain===location.host?"#0c0":a.domain.split(".").slice(-2).join(".")===location.host.split(".").slice(-2).join(".")?"#0a0":s("56789abcdef","01234567","abcdef"),a.id="reqByDomain-"+a.label.replace(/[^a-zA-Z]/g,"-"),a.durationAverage=Math.round(a.durationTotal/a.count),a});o("Requests by Domain",A,["Domains Total: "+h.length],[{name:"Requests",field:"count"},{name:"Avg. Duration (ms)",field:"durationAverage"}]),o("Requests by Initiator Type (host/external domain)",f.map(function(a){return a.perc=a.count/t,a.label=a.initiatorType,a.colour=u(a.initiatorType.split(" ")[0],s(x,y,z)),a.id="reqByTypeLocEx-"+a.label.replace(/[^a-zA-Z]/g,"-"),a}),["Requests to Host: "+l,"Host: "+location.host]),o("Requests by Initiator Type",e.map(function(a){return a.perc=a.count/t,a.label=a.initiatorType,a.colour=u(a.initiatorType,s(x,y,z)),a.id="reqByType-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),o("Requests by File Type",j.map(function(a){return a.perc=a.count/t,a.label=a.fileType,a.colour=v(a.fileType,s(x,y,z)),a.id="reqByType-"+a.label.replace(/[^a-zA-Z]/g,"-"),a})),k=k.concat([{name:"Requests by domain",data:h},{name:"Requests by Initiator Type",data:e,columns:["initiatorType","count","perc"]},{name:"Requests by Initiator Type (host/external domain)",data:f,columns:["initiatorType","count","perc"]},{name:"Requests by File Type",data:j,columns:["fileType","count","perc"]}])}),A(function(){var a={pageLoadTime:e.loadEventEnd-e.responseStart,lastResponseEnd:e.loadEventEnd-e.responseStart};for(var d in e)e[d]&&"number"==typeof e[d]&&(a[d]=e[d]-e.navigationStart);var f=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}},g=function(a,b,c,d,e,f){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d,segments:e,rawResource:f}},h=function(a,b,c){var d=n("div",{"class":"legend-holder"});d.appendChild(n("h4",{text:b}));var e=n("dl",{"class":"legend "+a});return c.forEach(function(a){e.appendChild(n("dt",{"class":"colorBoxHolder",childElement:n("span",{},"background:"+a[1])})),e.appendChild(n("dd",{text:a[0]}))}),d.appendChild(e),d},j=[f("Unload",a.unloadEventStart,a.unloadEventEnd,"#909"),f("Redirect",a.redirectStart,a.redirectEnd,"#ffff60"),f("App cache",a.fetchStart,a.domainLookupStart,"#1f831f"),f("DNS",a.domainLookupStart,a.domainLookupEnd,"#1f7c83"),f("TCP",a.connectStart,a.connectEnd,"#e58226"),f("Timer to First Byte",a.requestStart,a.responseStart,"#1fe11f"),f("Response",a.responseStart,a.responseEnd,"#1977dd"),f("DOM Processing",a.domLoading,a.domComplete,"#9cc"),f("domContentLoaded Event",a.domContentLoadedEventStart,a.domContentLoadedEventEnd,"#d888df"),f("Onload Event",a.loadEventStart,a.loadEventEnd,"#c0c0ff")];a.secureConnectionStart&&j.push(f("SSL",a.connectStart,a.secureConnectionStart,"#c141cd")),a.msFirstPaint&&j.push(f("msFirstPaint Event",a.msFirstPaint,a.msFirstPaint,"#8FBC83")),a.domInteractive&&j.push(f("domInteractive Event",a.domInteractive,a.domInteractive,"#d888df")),!a.redirectEnd&&!a.redirectStart&&a.fetchStart>a.navigationStart&&j.push(f("Cross-Domain Redirect",a.navigationStart,a.fetchStart,"#ffff60")),a.blocks=[g("Navigation API total",0,a.loadEventEnd,"#ccc",j)],b.forEach(function(b){var c=[f("Redirect",b.redirectStart,b.redirectEnd,"#ffff60"),f("DNS Lookup",b.domainLookupStart,b.domainLookupEnd,"#1f7c83"),f("Initial Connection (TCP)",b.connectStart,b.connectEnd,"#e58226"),f("secureConnect",b.secureConnectionStart||void 0,b.connectEnd,"#c141cd"),f("Timer to First Byte",b.requestStart,b.responseStart,"#1fe11f"),f("Content Download",b.responseStart||void 0,b.responseEnd,"#1977dd")],d=[0,b.redirectStart,b.domainLookupStart,b.connectStart,b.secureConnectionStart,b.requestStart,b.responseStart],e=d.reduce(function(a,c){return c>0&&(a>c||0>=a)&&c!=b.startTime?c:a});b.startTime<e&&c.unshift(f("Stalled/Blocking",b.startTime,e,"#cdcdcd")),a.blocks.push(g(b.name,Math.round(b.startTime),Math.round(b.responseEnd),u(b.initiatorType),c,b)),a.lastResponseEnd=Math.max(a.lastResponseEnd,b.responseEnd)}),a.loadDuration=Math.round(a.lastResponseEnd);var k=function(a,b){var d=a/100,e=b.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),f=c.length>0?c.reduce(function(a,b){return Math.max("number"==typeof a?a:0,r(q(b.name,"0")))}):0,g=25*(e.length+1),j=g+f+35,k=n("div",{"class":"resource-timing water-fall-holder chart-holder"}),l=p("svg:svg",{height:Math.floor(j),"class":"water-fall-chart"}),m=p("g",{"class":"labels"}),o=p("line",{x1:"0",y1:"0",x2:"0",y2:g,"class":"line-end"}),s=p("line",{x1:"0",y1:"0",x2:"0",y2:g,"class":"line-start"}),t=function(a){var b=a.target;y(b,"active");var c=b.x.baseVal.valueInSpecifiedUnits+b.width.baseVal.valueInSpecifiedUnits+"%",d=b.x.baseVal.valueInSpecifiedUnits+"%";o.x1.baseVal.valueAsString=c,o.x2.baseVal.valueAsString=c,s.x1.baseVal.valueAsString=d,s.x2.baseVal.valueAsString=d,y(o,"active"),y(s,"active"),b.parentNode.appendChild(o),b.parentNode.appendChild(s)},u=function(a){z(a.target,"active"),z(o,"active"),z(s,"active")},v=function(a,b,c,e,f,g,h){var i,j=p("rect",{width:a/d+"%",height:b-1,x:c/d+"%",y:e,fill:f,"class":h&&h.length>0?"time-block":"segment"});return g&&j.appendChild(p("title",{text:g})),j.addEventListener("mouseenter",t),j.addEventListener("mouseleave",u),h&&h.length>0?(i=p("g"),i.appendChild(j),h.forEach(function(a){a.total>0&&"number"==typeof a.start&&i.appendChild(v(a.total,8,a.start||.001,e,a.colour,a.name+" ("+Math.round(a.start)+"ms - "+Math.round(a.end)+"ms | total: "+Math.round(a.total)+"ms)"))}),i):j},w=function(){for(var b=p("g",{"class":"time-scale full-width"}),c=0,d=a/1e3,e=100/d;d>=c;c++){var f=q(c+"sec",g);c>d-.2?(f.setAttribute("x",e*c-.5+"%"),f.setAttribute("text-anchor","end")):f.setAttribute("x",e*c+.5+"%");var h=p("line",{x1:e*c+"%",y1:"0",x2:e*c+"%",y2:g});b.appendChild(h),b.appendChild(f)}return b},x=function(){var a=p("g",{transform:"scale(1, 1)","class":"marker-holder"});return c.forEach(function(b,e){var f=p("g",{"class":"mark-holder"}),h=p("g",{"class":"line-holder"}),i=b.startTime/d;b.x=i;var j=q(b.name,g+25);j.setAttribute("writing-mode","tb"),j.setAttribute("x",i+"%"),j.setAttribute("stroke",""),h.appendChild(p("line",{x1:i+"%",y1:0,x2:i+"%",y2:g})),c[e-1]&&b.x-c[e-1].x<1&&(j.setAttribute("x",c[e-1].x+1+"%"),b.x=c[e-1].x+1),h.appendChild(p("line",{x1:i+"%",y1:g,x2:b.x+"%",y2:g+23})),j.addEventListener("mouseenter",function(){y(h,"active"),f.parentNode.appendChild(f)}),j.addEventListener("mouseleave",function(){z(h,"active")}),f.appendChild(p("title",{text:b.name+" ("+Math.round(b.startTime)+"ms)"})),f.appendChild(h),f.appendChild(j),a.appendChild(f)}),a};l.appendChild(w()),l.appendChild(x()),e.forEach(function(a,b){var c=a.total||1,e=25*b;l.appendChild(v(c,25,a.start||.001,e,a.colour,a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)",a.segments));var f=q(a.name+" ("+a.total+"ms)",e+20);(a.total||1)/d>10&&r(f)<200?(f.setAttribute("class","inner-label"),f.setAttribute("x",(a.start||.001)/d+.5+"%"),f.setAttribute("width",c/d+"%")):(a.start||.001)/d+c/d<80?f.setAttribute("x",(a.start||.001)/d+c/d+.5+"%"):(f.setAttribute("x",(a.start||.001)/d-.5+"%"),f.setAttribute("text-anchor","end")),f.style.opacity=a.name.match(/js.map$/)?"0.5":"1",m.appendChild(f)}),l.appendChild(m),k.appendChild(n("h1",{text:"Resource Timing"})),k.appendChild(l),k.appendChild(n("h3",{text:"Legend"}));var A=n("div",{"class":"legends-group "});A.appendChild(h("initiator-type-legend","Block color: Initiator Type",[["css","#afd899"],["iframe","#85b3f2"],["img","#bc9dd6"],["script","#e7bd8c"],["link","#89afe6"],["swf","#4db3ba"],["xmlhttprequest","#e7d98c"]])),A.appendChild(h("navigation-legend","Navigation Timing",[["Redirect","#ffff60"],["App Cache","#1f831f"],["DNS Lookup","#1f7c83"],["TCP","#e58226"],["SSL Negotiation","#c141cd"],["Time to First Byte","#1fe11f"],["Content Download","#1977dd"],["DOM Processing","#9cc"],["DOM Content Loaded","#d888df"],["On Load","#c0c0ff"]])),A.appendChild(h("resource-legend","Resource Timing",[["Stalled/Blocking","#cdcdcd"],["Redirect","#ffff60"],["App Cache","#1f831f"],["DNS Lookup","#1f7c83"],["TCP","#e58226"],["SSL Negotiation","#c141cd"],["Initial Connection (TCP)","#e58226"],["Time to First Byte","#1fe11f"],["Content Download","#1977dd"]])),k.appendChild(A),i.appendChild(k)};k(a.loadDuration,a.blocks)}),A(function(){g.body.appendChild(h),f.style.height=h.clientHeight+"px"}),k.forEach(function(a){a.data.length>0&&console.table&&(console.log("\n\n\n"+a.name+":"),console.table(a.data,a.columns))})}}();