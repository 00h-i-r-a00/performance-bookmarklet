/*https://github.com/micmro/performance-bookmarklet by Michael Mrowetz @MicMro*/
!function(){"use strict";var a,b,c,d,e="body {overflow: hidden; background: #fff; font:normal 12px/18px sans-serif; color:#333;} * {box-sizing:border-box;} svg {font:normal 12px/18px sans-serif;} th {text-align: left;} #perfbook-holder {overflow: hidden; width:100%; padding:1em 2em 3em;} #perfbook-content {position:relative;} .perfbook-close {position:absolute; top:0; right:0; padding:1em; z-index:1; background:transparent; border:0; cursor:pointer;} .full-width {width:100%;} .chart-holder {margin: 5em 0;} h1 {font:bold 18px/18px sans-serif; margin:1em 0; color:#666;} .text-right {text-align: right;} .text-left {text-align: left;} .css {background: #afd899;} .iframe, .html, .internal {background: #85b3f2;} .img, .image {background: #bc9dd6;} .script, .js {background: #e7bd8c;} .link {background: #89afe6;} .swf, .flash {background: #4db3ba;} .font {background: #e96859;} .xmlhttprequest, .ajax {background: #e7d98c;} .other {background: #bebebe;} .css-light {background: #b9cfa0;} .iframe-light, .html-light, .internal-light {background: #c2d9f9;} .img-light, .image-light {background: #deceeb;} .script-light, .js-light {background: #f3dec6;} .link-light {background: #c4d7f3;} .swf-light, .flash-light {background: #a6d9dd;} .font-light {background: #f4b4ac;} .xmlhttprequest-light, .ajax-light {background: #f3ecc6;} .other-light {background: #dfdfdf;} .tiles-holder {margin: 2em -18px 2em 0; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-flex-flow: row wrap; flex-flow: row wrap; } .summary-tile { flex-grow: 1; width:250px; background:#ddd; padding: 1em; margin:0 18px 1em 0; color:#666; text-align:center;} .summary-tile dt {font-weight:bold; font-size:16px; display:block; line-height:1.2em; min-height:2.9em; padding:0 0 0.5em;} .summary-tile dd {font-weight:bold; line-height:60px; margin:0;} .summary-tile-appendix {float:left; clear:both; width:100%; font-size:10px; line-height:1.1em; color:#666;} .summary-tile-appendix dt {float:left; clear:both;} .summary-tile-appendix dd {float:left; margin:0 0 0 1em;} .pie-charts-holder {margin-right: -72px; display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-flex-flow: row wrap; flex-flow: row wrap;} .pie-chart-holder {flex-grow: 1; width:350px; max-width: 600px; margin: 0 72px 0 0;} .pie-chart-holder h1 {min-height:2em;} .pie-chart {width:100%;} .table-holder {overflow-x:auto} .table-holder table {float:left; width:100%; font-size:12px; line-height:18px;} .table-holder th, .table-holder td {line-height: 1em; margin:0; padding:0.25em 0.5em 0.25em 0;} #filetypes-and-intiators-table {margin: 2em 0 5em;} #filetypes-and-intiators-table table {vertical-align: middle; border-collapse: collapse;} #filetypes-and-intiators-table td {padding:0.5em; border-right: solid 1px #fff;} #filetypes-and-intiators-table td:last-child {padding-right: 0; border-right:0;} #filetypes-and-intiators-table .file-type-row td {border-top: solid 10px #fff;} #filetypes-and-intiators-table .file-type-row:first-child td {border-top: none;} .water-fall-holder {fill:#ccc;} .water-fall-chart {width:100%; background:#f0f5f0;} .water-fall-chart .marker-holder {width:100%;} .water-fall-chart .line-holder {stroke-width:1; stroke: #a971c5; stroke-opacity:0.5;} .water-fall-chart .line-holder.active {stroke: #69009e; stroke-width:2; stroke-opacity:1;} .water-fall-chart .labels {width:100%;} .water-fall-chart .labels .inner-label {pointer-events: none;} .water-fall-chart .time-block.active {opacity: 0.8;} .water-fall-chart .line-end, .water-fall-chart .line-start {display: none; stroke-width:1; stroke-opacity:0.5; stroke: #000;} .water-fall-chart .line-end.active, .water-fall-chart .line-start.active {display: block;} .time-scale line {stroke:#0cc; stroke-width:1;} .time-scale text {font-weight:bold;} .navigation-timing {} .legends-group { display: -webkit-box; display: -moz-box; display: -ms-flexbox; display: -webkit-flex; display: flex; -webkit-flex-flow: row wrap; flex-flow: row wrap; } .legends-group .legend-holder { flex-grow: 1; width:250px; padding:0 1em 1em; } .legends-group .legend-holder h4 { margin: 0; padding: 0; } .legend dt {float: left; clear: left; padding: 0 0 0.5em;} .legend dd {float: left; display: inline-block; margin: 0 1em; line-height: 1em;} .legend .colorBoxHolder span {display: inline-block; width: 15px; height: 1em;}",f=function(a){a.getFileType=function(a,b){if(a)switch(a){case"jpg":case"jpeg":case"png":case"gif":case"webp":case"svg":case"ico":return"image";case"js":return"js";case"css":return"css";case"html":return"html";case"woff":case"woff2":case"ttf":case"eot":case"otf":return"font";case"swf":return"flash";case"map":return"source-map"}if(b)switch(b){case"xmlhttprequest":return"ajax";case"img":return"image";case"script":return"js";case"internal":case"iframe":return"html";default:return"other"}return b},a.getRandomColor=function(a,b,c){for(var d=[a||"0123456789ABCDEF",b||"0123456789ABCDEF",c||"0123456789ABCDEF"],e="#",f=0,g=0;6>g;g++)f=Math.floor(g/2),e+=d[f].split("")[Math.floor(Math.random()*d[f].length)];return e},a.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)};var b=function(a,b){var c=(parseInt(a.substr(1,2),16)+b).toString(16),d=(parseInt(a.substr(3,2),16)+b).toString(16),e=(parseInt(a.substr(5,2),16)+b).toString(16);return"#"+c+d+e};return a.getInitiatorTypeColour=function(a,c,d){var e=c||"#bebebe";switch(a){case"css":e="#afd899";break;case"iframe":e="#85b3f2";break;case"img":e="#bc9dd6";break;case"script":e="#e7bd8c";break;case"link":e="#89afe6";break;case"swf":e="#4db3ba";break;case"font":e="#e96859";break;case"xmlhttprequest":e="#e7d98c"}return d===!0?b(e,-5):e},a.getFileTypeColour=function(a,c,d){var e=c||"#bebebe";switch(a){case"css":e="#afd899";break;case"html":e="#85b3f2";break;case"image":e="#bc9dd6";break;case"js":e="#e7bd8c";break;case"link":e="#89afe6";break;case"swf":e="#4db3ba";break;case"font":e="#e96859";break;case"ajax":e="#e7d98c"}return d===!0?b(e,-5):e},a.getItemCount=function(a,b){var c,d={},e=[];a.forEach(function(a){d[a]=d[a]?d[a]+1:1});for(var f in d)c={},c[b||"key"]=f,c.count=d[f],e.push(c);return e.sort(function(a,b){return a.count<b.count?1:-1})},a}({}),g=function(a){return a.newTextNode=function(a){return document.createTextNode(a)},a.newTag=function(b,c,d){c=c||{};var e=document.createElement(b);for(var f in c)"text"!=f&&(e[f]=c[f]);return c.text?e.textContent=c.text:c.childElement&&("object"==typeof c.childElement?c.childElement instanceof NodeList?Array.prototype.slice.call(c.childElement,0).forEach(function(a){e.appendChild(a)}):e.appendChild(c.childElement):e.appendChild(a.newTextNode(c.childElement))),c["class"]&&(e.className=c["class"]),e.style.cssText=d||"",e},a.tableFactory=function(b,c,d){var e=a.newTag("div",{id:b||"","class":"table-holder"}),f=a.newTag("table"),g=a.newTag("thead");return g.appendChild(c(a.newTag("tr"))),f.appendChild(g),f.appendChild(d(a.newTag("tbody"))),e.appendChild(f),e},a.combineNodes=function(b,c){var d=document.createElement("div");return"object"==typeof b?d.appendChild(b):"string"==typeof b&&d.appendChild(a.newTextNode(b)),"object"==typeof c?d.appendChild(c):"string"==typeof c&&d.appendChild(a.newTextNode(c)),d.childNodes},a.addClass=function(a,b){return a.classList?a.classList.add(b):a.setAttribute("class",a.getAttribute("class")+" "+b),a},a.removeClass=function(a,b){return a.classList?a.classList.remove(b):a.setAttribute("class",a.getAttribute("class").replace(new RegExp("(\\s|^)"+b+"(\\s|$)","g"),"$2")),a},a}({}),h=function(a){return a.newEl=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);b=b||{};for(var e in b)"text"!=e&&d.setAttributeNS(null,e,b[e]);return d.textContent=b.text||"",d.style.cssText=c||"",d},a.newTextEl=function(b,c,d){return a.newEl("text",{fill:"#111",y:c,text:b},(d||"")+" text-shadow:0 0 4px #fff;")},a.getNodeTextWidth=function(c){var d=a.newEl("svg:svg",{},"visibility:hidden;");d.appendChild(c),b.body.appendChild(d);var e=c.getBBox().width;return d.parentNode.removeChild(d),e},a}({}),i={resources:[],marks:[],measures:[],perfTiming:[],allResourcesCalc:[]},j=[];if("about:"!==location.protocol){if(window.performance&&void 0!==window.performance.getEntriesByType)i.resources=window.performance.getEntriesByType("resource"),i.marks=window.performance.getEntriesByType("mark"),i.measures=window.performance.getEntriesByType("measure");else{if(!window.performance||void 0===window.performance.webkitGetEntriesByType)return void alert("Oups, looks like this browser does not support the Resource Timing API\ncheck http://caniuse.com/#feat=resource-timing to see the ones supporting it \n\n");i.resources=window.performance.webkitGetEntriesByType("resource"),i.marks=window.performance.webkitGetEntriesByType("mark"),i.measures=window.performance.webkitGetEntriesByType("measure")}if(!window.performance.timing)return void alert("Oups, looks like this browser does not support performance timing");if(i.perfTiming=window.performance.timing,i.perfTiming.loadEventEnd-i.perfTiming.navigationStart<0)return void alert("Page is still loading - please try again when page is loaded.");i.allResourcesCalc=i.resources.filter(function(a){return!a.name.match(/http[s]?\:\/\/nurun.github.io\/performance-bookmarklet\/.*/)}).map(function(a){var b,c,d,e=0===a.name.indexOf("http");e?(b=a.name.match(/:\/\/(.[^/]+)([^?]*)\??(.*)/),c=b[2].split("/").pop(),d=c.substr((Math.max(0,c.lastIndexOf("."))||1/0)+1)):(b=["",location.host],d=a.name.split(":")[0]);var g={name:a.name,domain:b[1],initiatorType:a.initiatorType||d||"SourceMap or Not Defined",fileExtension:d||"XHR or Not Defined",loadtime:a.duration,fileType:f.getFileType(d,a.initiatorType),isRequestToHost:b[1]===location.host};for(var h in a)"function"!=typeof a[h]&&(g[h]=a[h]);return a.requestStart&&(g.requestStartDelay=a.requestStart-a.startTime,g.dns=a.domainLookupEnd-a.domainLookupStart,g.tcp=a.connectEnd-a.connectStart,g.ttfb=a.responseStart-a.startTime,g.requestDuration=a.responseStart-a.requestStart),a.secureConnectionStart&&(g.ssl=a.connectEnd-a.secureConnectionStart),g}),j.push({name:"All loaded resources",data:i.allResourcesCalc,columns:["name","domain","fileType","initiatorType","fileExtension","loadtime","isRequestToHost","requestStartDelay","dns","tcp","ttfb","requestDuration","ssl"]});var k=function(a,b){var c;document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0)):(c=document.createEventObject(),c.eventType=b),c.eventName=b,document.createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)},l=function(){var a=!1,b=[],c=function(){a=!0,window.removeEventListener("iFrameLoaded",c,!1),b.forEach(function(a){a(f,g,h)})};return window.addEventListener("iFrameLoaded",c,!1),function(c){a?c(f,g,h):b.push(c)}}();a=document.getElementById("perfbook-iframe"),a?(b=a.contentWindow.document,c=b.getElementById("perfbook-holder"),k(window,"iFrameLoaded")):(a=g.newTag("iframe",{id:"perfbook-iframe",onload:function(){b=a.contentWindow.document;var c=g.newTag("style",{type:"text/css",text:e});b.head.appendChild(c),k(window,"iFrameLoaded")}},"position:absolute; top:1%; right:1%; margin-bottom:1em; left:1%; z-index: 9999; width:98%; z-index: 9999; border:0; box-shadow:0 0 25px 0 rgba(0,0,0,0.5); background:#fff;"),document.body.appendChild(a)),l(function(e,f){if(c)for(d=b.getElementById("perfbook-content");d.firstChild;)d.removeChild(d.firstChild);else{c=f.newTag("div",{id:"perfbook-holder"}),d=f.newTag("div",{id:"perfbook-content"});var g=f.newTag("button",{"class":"perfbook-close",text:"close"});g.addEventListener("click",function(){a.parentNode.removeChild(a)}),c.appendChild(g),c.appendChild(d)}}),l(function(a,b){var c,e,f,g,h,j,k,l,m,n,o,p;c=i.allResourcesCalc.filter(function(a){return 0===a.name.indexOf("http")&&!a.name.match(/js.map$/)}),e=a.getItemCount(c.map(function(a){return a.domain}),"domain"),f=c.filter(function(a){return a.domain.split(".").slice(-2).join(".")===location.host.split(".").slice(-2).join(".")}).length,g=c.filter(function(b){return!a.endsWith(b.domain,document.domain)}).length,h=c.filter(function(a){return a.domain===location.host}).length,j=e.filter(function(b){return a.endsWith(b.domain,location.host.split(".").slice(-2).join("."))&&b.domain!==location.host}).length,i.allResourcesCalc.length>0&&(k=i.allResourcesCalc.filter(function(a){return a.name!==location.href}).sort(function(a,b){return b.duration-a.duration}),l=Math.floor(k.reduceRight(function(a,b){return"number"!=typeof a?a.duration+b.duration:a+b.duration})/k.length)),m=function(a,c,d){d=d||60;var e=b.newTag("dl",{"class":"summary-tile"});return e.appendChild(b.newTag("dt",{childElement:a})),e.appendChild(b.newTag("dd",{childElement:c},"font-size:"+d+"px;")),e},n=function(a,c,d){a.appendChild(b.newTag("dt",{childElement:c})),a.appendChild(b.newTag("dd",{text:d}))},o=b.newTag("section",{"class":"tiles-holder chart-holder"}),[m("Requests",c.length||"0"),m("Domains",e.length||"0"),m(b.combineNodes("Subdomains of ",b.newTag("abbr",{title:"Top Level Domain",text:"TLD"})),j||"0"),m(b.combineNodes("Requests to ",b.newTag("span",{title:location.host,text:"Host"})),h||"0"),m(b.combineNodes(b.newTag("abbr",{title:"Top Level Domain",text:"TLD"}),"& Subdomain Requests"),f||"0"),m("Total",i.perfTiming.loadEventEnd-i.perfTiming.navigationStart+"ms",40),m("Time to First Byte",i.perfTiming.responseStart-i.perfTiming.navigationStart+"ms",40),m(b.newTag("span",{title:"domLoading to domContentLoadedEventStart",text:"DOM Content Loading"}),i.perfTiming.domContentLoadedEventStart-i.perfTiming.domLoading+"ms",40),m(b.newTag("span",{title:"domLoading to loadEventStart",text:"DOM Processing"}),i.perfTiming.domComplete-i.perfTiming.domLoading+"ms",40)].forEach(function(a){o.appendChild(a)}),i.allResourcesCalc.length>0&&(o.appendChild(m(b.newTag("span",{title:k[0].name,text:"Slowest Call"}),b.newTag("span",{title:k[0].name,text:Math.floor(k[0].duration)+"ms"}),40)),o.appendChild(m("Average Call",l+"ms",40))),p=b.newTag("dl",{"class":"summary-tile-appendix"}),n(p,b.newTag("abbr",{title:"Top Level Domain",text:"TLD"},location.host.split(".").slice(-2).join("."))),n(p,b.newTextNode("Host:"),location.host),n(p,b.newTextNode("document.domain:"),document.domain),o.appendChild(p),d.appendChild(o)}),l(function(a,b,c){var e={pageLoadTime:i.perfTiming.loadEventEnd-i.perfTiming.navigationStart,output:[]},f=i.perfTiming.navigationStart;for(var g in i.perfTiming)i.perfTiming[g]&&"number"==typeof i.perfTiming[g]&&(e[g]=i.perfTiming[g]-f,e.output.push({name:g,"time (ms)":i.perfTiming[g]-f}));e.output.sort(function(a,b){return(a["time (ms)"]||0)-(b["time (ms)"]||0)});var h=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}};e.blocks=[h("Total",0,e.pageLoadTime,"#ccc"),h("Unload",e.unloadEventStart,e.unloadEventEnd,"#909"),h("Redirect ("+performance.navigation.redirectCount+"x)",e.redirectStart,e.redirectEnd,"#ffff60"),h("App cache",e.fetchStart,e.domainLookupStart,"#1f831f"),h("DNS",e.domainLookupStart,e.domainLookupEnd,"#1f7c83"),h("TCP",e.connectStart,e.connectEnd,"#e58226"),h("Timer to First Byte",e.requestStart,e.responseStart,"#1fe11f"),h("Response",e.responseStart,e.responseEnd,"#1977dd"),h("DOM Processing",e.domLoading,e.domComplete,"#9cc"),h("domContentLoaded Event",e.domContentLoadedEventStart,e.domContentLoadedEventEnd,"#d888df"),h("onload Event",e.loadEventStart,e.loadEventEnd,"#c0c0ff")],e.secureConnectionStart&&e.blocks.push(h("SSL",e.connectStart,e.secureConnectionStart,"#c141cd")),e.msFirstPaint&&e.blocks.push(h("msFirstPaint Event",e.msFirstPaint,e.msFirstPaint,"#8FBC83")),e.domInteractive&&e.blocks.push(h("domInteractive Event",e.domInteractive,e.domInteractive,"#d888df")),!e.redirectEnd&&!e.redirectStart&&e.fetchStart>e.navigationStart&&e.blocks.push(h("Cross-Domain Redirect (and/or other Delay)",e.navigationStart,e.fetchStart,"#ffff60")),e.blocks.push(h("Network/Server",e.navigationStart,e.responseStart,"#8cd18c")),i.measures.forEach(function(a){e.blocks.push(h("measure:"+a.name,Math.round(a.startTime),Math.round(a.startTime+a.duration),"#f00"))});var k=function(){var a=e.pageLoadTime/100,f=e.blocks.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),g=i.marks.length>0?i.marks.reduce(function(a,b){return Math.max("number"==typeof a?a:0,c.getNodeTextWidth(c.newTextEl(b.name,"0")))}):0,h=25*(f.length+1),j=h+g+35,k=b.newTag("section",{"class":"navigation-timing water-fall-holder chart-holder"}),l=c.newEl("svg:svg",{height:Math.floor(j),"class":"water-fall-chart"}),m=c.newEl("g",{"class":"labels"}),n=c.newEl("line",{x1:"0",y1:"0",x2:"0",y2:h,"class":"line-end"}),o=c.newEl("line",{x1:"0",y1:"0",x2:"0",y2:h,"class":"line-start"}),p=function(a){var c=a.target;b.addClass(c,"active");var d=c.x.baseVal.valueInSpecifiedUnits+c.width.baseVal.valueInSpecifiedUnits+"%",e=c.x.baseVal.valueInSpecifiedUnits+"%";n.x1.baseVal.valueAsString=d,n.x2.baseVal.valueAsString=d,o.x1.baseVal.valueAsString=e,o.x2.baseVal.valueAsString=e,b.addClass(n,"active"),b.addClass(o,"active"),c.parentNode.appendChild(n),c.parentNode.appendChild(o)},q=function(a){b.removeClass(a.target,"active"),b.removeClass(n,"active"),b.removeClass(o,"active")},r=function(b,d,e,f,g,h){var i=c.newEl("rect",{width:b/a+"%",height:d,x:e/a+"%",y:f,fill:g,"class":"time-block"});return h&&i.appendChild(c.newEl("title",{text:h})),i.addEventListener("mouseenter",p),i.addEventListener("mouseleave",q),i},s=function(){for(var a=c.newEl("g",{"class":"time-scale full-width"}),b=0,d=e.pageLoadTime/1e3,f=100/d;d>=b;b++){var g=c.newTextEl(b+"sec",h);b>d-.2?(g.setAttribute("x",f*b-.5+"%"),g.setAttribute("text-anchor","end")):g.setAttribute("x",f*b+.5+"%");var i=c.newEl("line",{x1:f*b+"%",y1:"0",x2:f*b+"%",y2:h});a.appendChild(i),a.appendChild(g)}return a},t=function(){var d=c.newEl("g",{transform:"scale(1, 1)","class":"marker-holder"});return i.marks.forEach(function(e,f){var g=c.newEl("g",{"class":"mark-holder"}),j=c.newEl("g",{"class":"line-holder"}),k=e.startTime/a;e.x=k;var l=c.newTextEl(e.name,h+25);l.setAttribute("writing-mode","tb"),l.setAttribute("x",k+"%"),l.setAttribute("stroke",""),j.appendChild(c.newEl("line",{x1:k+"%",y1:"0px",x2:k+"%",y2:h})),i.marks[f-1]&&e.x-i.marks[f-1].x<1&&(l.setAttribute("x",i.marks[f-1].x+1+"%"),e.x=i.marks[f-1].x+1),j.appendChild(c.newEl("line",{x1:k+"%",y1:h,x2:e.x+"%",y2:h+23})),g.addEventListener("mouseenter",function(){b.addClass(j,"active"),g.parentNode.appendChild(g)}),g.addEventListener("mouseleave",function(){b.removeClass(j,"active")}),g.appendChild(c.newEl("title",{text:e.name+" ("+Math.round(e.startTime)+"ms)"})),g.appendChild(j),g.appendChild(l),d.appendChild(g)}),d};l.appendChild(s()),l.appendChild(t()),f.forEach(function(b,d){var e=b.total||1,f=25*d;l.appendChild(r(e,25,b.start||.001,f,b.colour,b.name+" ("+b.start+"ms - "+b.end+"ms | total: "+b.total+"ms)"));var g=c.newTextEl(b.name+" ("+b.total+"ms)",f+18);(b.total||1)/a>10?(g.setAttribute("class","inner-label"),g.setAttribute("x",(b.start||.001)/a+.5+"%"),g.setAttribute("width",e/a+"%")):(b.start||.001)/a+e/a<80?g.setAttribute("x",(b.start||.001)/a+e/a+.5+"%"):(g.setAttribute("x",(b.start||.001)/a-.5+"%"),g.setAttribute("text-anchor","end")),m.appendChild(g)}),l.appendChild(m),k.appendChild(b.newTag("h1",{text:"Navigation Timing"})),k.appendChild(l),d.appendChild(k)};k(),j=j.concat([{name:"Navigation Timeline",data:e.blocks,columns:["name","start","end","total"]},{name:"Navigation Events",data:e.output},{name:"Marks",data:i.marks,columns:["name","startTime","duration"]}])}),l(function(a,c,e){function f(c,d){var f=e.newEl("svg:svg",{viewBox:"0 0 "+d+" "+d,"class":"pie-chart"},"max-height:"+(.98*window.innerWidth-64)/3+"px;"),g=2*Math.PI/100,h=0,i=function(a,c,d,f,i){var j=c/2,k=h+(d*g-.001),l=h+(d/2*g-.001),m=j+j*Math.sin(h),n=j-j*Math.cos(h),o=j+j*Math.sin(k),p=j-j*Math.cos(k),q=j+.85*j*Math.sin(l),r=j-.85*j*Math.cos(l),s=k-h>Math.PI?1:0,t="M "+j+","+j+" L "+m+","+n+" A "+j+","+j+" 0 "+s+" 1 "+o+","+p+" Z",u=e.newEl("path",{id:a,d:t,fill:i});if(u.appendChild(e.newEl("title",{text:f})),u.addEventListener("mouseenter",function(a){a.target.style.opacity="0.5",b.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="#ccc"}),u.addEventListener("mouseleave",function(a){a.target.style.opacity="1",b.getElementById(a.target.getAttribute("id")+"-table").style.backgroundColor="transparent"}),h=k,d>10){var v=e.newTextEl(f,r);return l<Math.PI?v.setAttribute("x",q-e.getNodeTextWidth(v)):v.setAttribute("x",q),{path:u,wedgeLabel:v}}return{path:u}},j=e.newEl("g",{},"pointer-events:none; font-weight:bold;"),k=e.newEl("g");return c.forEach(function(b){var c=i(b.id,d,b.perc,b.label+" ("+b.count+")",b.colour||a.getRandomColor());k.appendChild(c.path),c.wedgeLabel&&j.appendChild(c.wedgeLabel)}),k.appendChild(e.newEl("circle",{cx:d/2,cy:d/2,r:.05*d,fill:"#fff"})),f.appendChild(k),f.appendChild(j),f}var g=function(a,b,d){return d=d||[{name:"Requests",field:"count"}],c.tableFactory("",function(b){return b.appendChild(c.newTag("th",{text:a,"class":"text-left"})),d.forEach(function(a){b.appendChild(c.newTag("th",{text:a.name,"class":"text-right"}))}),b.appendChild(c.newTag("th",{text:"Percentage","class":"text-right"})),b},function(a){return b.forEach(function(b){var e=c.newTag("tr",{id:b.id+"-table"});e.appendChild(c.newTag("td",{text:b.label})),d.forEach(function(a){e.appendChild(c.newTag("td",{text:b[a.field],"class":"text-right"}))}),e.appendChild(c.newTag("td",{text:b.perc.toPrecision(2)+"%","class":"text-right"})),a.appendChild(e)}),a})},h=i.allResourcesCalc.filter(function(a){return 0===a.name.indexOf("http")&&!a.name.match(/js.map$/)}),k=a.getItemCount(h.map(function(a){return a.initiatorType||a.fileExtension}),"initiatorType"),l=a.getItemCount(h.map(function(a){return(a.initiatorType||a.fileExtension)+" "+(a.isRequestToHost?"(host)":"(external)")}),"initiatorType"),m=a.getItemCount(h.map(function(a){return a.domain}),"domain"),n=a.getItemCount(h.map(function(a){return a.fileType+" "+(a.isRequestToHost?"(host)":"(external)")}),"fileType"),o=a.getItemCount(h.map(function(a){return a.fileType}),"fileType");h.forEach(function(a){var b=m.filter(function(b){return b.domain==a.domain})[0]||{};b.durationTotal=(b.durationTotal||0)+a.duration});var p=h.filter(function(a){return a.domain===location.host}).length,q=c.newTag("div",{"class":"pie-charts-holder chart-holder"}),r=function(a,b,d,e){var i=c.newTag("div",{"class":"pie-chart-holder"});i.appendChild(c.newTag("h1",{text:a})),i.appendChild(f(b,400)),i.appendChild(c.newTag("p",{text:"Total Requests: "+h.length})),d&&d.length&&d.forEach(function(a){i.appendChild(c.newTag("p",{text:a},"margin-top:-1em"))}),i.appendChild(g(a,b,e)),q.appendChild(i)};d.appendChild(q);var s=h.length/100,t="789abcdef",u="789abcdef",v="789abcdef",w=m.map(function(b){return b.perc=b.count/s,b.label=b.domain,b.colour=b.domain===location.host?"#0c0":b.domain.split(".").slice(-2).join(".")===location.host.split(".").slice(-2).join(".")?"#0a0":a.getRandomColor("56789abcdef","01234567","abcdef"),b.id="reqByDomain-"+b.label.replace(/[^a-zA-Z]/g,"-"),b.durationAverage=Math.round(b.durationTotal/b.count),b});r("Requests by Domain",w,["Domains Total: "+m.length],[{name:"Requests",field:"count"},{name:"Avg. Duration (ms)",field:"durationAverage"}]),r("Requests by Initiator Type",k.map(function(b){return b.perc=b.count/s,b.label=b.initiatorType,b.colour=a.getInitiatorTypeColour(b.initiatorType,a.getRandomColor(t,u,v)),b.id="reqByInitiatorType-"+b.label.replace(/[^a-zA-Z]/g,"-"),b})),r("Requests by Initiator Type (host/external domain)",l.map(function(b){var c=b.initiatorType.split(" ");return b.perc=b.count/s,b.label=b.initiatorType,b.colour=a.getInitiatorTypeColour(c[0],a.getRandomColor(t,u,v),"(host)"!==c[1]),b.id="reqByInitiatorTypeLocEx-"+b.label.replace(/[^a-zA-Z]/g,"-"),b}),["Requests to Host: "+p,"Host: "+location.host]),r("Requests by File Type",o.map(function(b){return b.perc=b.count/s,b.label=b.fileType,b.colour=a.getFileTypeColour(b.fileType,a.getRandomColor(t,u,v)),b.id="reqByFileType-"+b.label.replace(/[^a-zA-Z]/g,"-"),b})),r("Requests by File Type (host/external domain)",n.map(function(b){var c=b.fileType.split(" ");return b.perc=b.count/s,b.label=b.fileType,b.colour=a.getFileTypeColour(c[0],a.getRandomColor(t,u,v),"(host)"!==c[1]),b.id="reqByFileType-"+b.label.replace(/[^a-zA-Z]/g,"-"),b}),["Requests to Host: "+p,"Host: "+location.host]),j=j.concat([{name:"Requests by domain",data:m},{name:"Requests by Initiator Type",data:k,columns:["initiatorType","count","perc"]},{name:"Requests by Initiator Type (host/external domain)",data:l,columns:["initiatorType","count","perc"]},{name:"Requests by File Type",data:o,columns:["fileType","count","perc"]}])}),l(function(a,b){var c=i.allResourcesCalc.filter(function(a){return 0===a.name.indexOf("http")&&!a.name.match(/js.map$/)});window.requestsOnly=c;var e=c.reduce(function(a,b){var c,d=a[b.fileType];return d||(d=a[b.fileType]={fileType:b.fileType,count:0,initiatorType:{},requestsToHost:0,requestsToExternal:0}),c=d.initiatorType[b.initiatorType],c||(c=d.initiatorType[b.initiatorType]={initiatorType:b.initiatorType,count:0,requestsToHost:0,requestsToExternal:0}),d.count++,c.count++,b.isRequestToHost?(d.requestsToHost++,c.requestsToHost++):(d.requestsToExternal++,c.requestsToExternal++),a},{}),f=b.newTag("section",{"class":"table-section-holder chart-holder"});f.appendChild(b.newTag("h1",{text:"Request FileTypes & Initiators"})),f.appendChild(b.tableFactory("filetypes-and-intiators-table",function(a){return["FileType","Count","Count Internal","Count External","Initiator Type","Count by Initiator Type","Initiator Type Internal","Initiator Type External"].forEach(function(c){a.appendChild(b.newTag("th",{text:c,width:c.indexOf("ternal")>0?"12%":""}))}),a},function(a){return Object.keys(e).forEach(function(c){var d=e[c],f=Object.keys(d.initiatorType),g=d.initiatorType[f[0]],h=f.length,i=b.newTag("tr",{"class":"file-type-row "+(d.fileType||"other")+"-light"});[d.fileType,d.count,d.requestsToHost,d.requestsToExternal,g.initiatorType,g.count,g.requestsToHost,g.requestsToExternal].forEach(function(a,c){var d={text:a};4>c&&f.length>1?d.rowSpan=h:c>=4&&(d["class"]=(f[0]||"other")+"-light"),i.appendChild(b.newTag("td",d))}),a.appendChild(i),f.slice(1).forEach(function(c){var e=d.initiatorType[c],f=b.newTag("tr",{"class":"initiator-type-more "+(c||"other")+"-light"});f.appendChild(b.newTag("td",{text:c})),f.appendChild(b.newTag("td",{text:e.count})),f.appendChild(b.newTag("td",{text:e.requestsToHost})),f.appendChild(b.newTag("td",{text:e.requestsToExternal})),a.appendChild(f)})}),a})),d.appendChild(f)}),l(function(a,b){var c={pageLoadTime:i.perfTiming.loadEventEnd-i.perfTiming.responseStart,lastResponseEnd:i.perfTiming.loadEventEnd-i.perfTiming.responseStart};for(var e in i.perfTiming)i.perfTiming[e]&&"number"==typeof i.perfTiming[e]&&(c[e]=i.perfTiming[e]-i.perfTiming.navigationStart);var f=function(a,b,c,d){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d}},g=function(a,b,c,d,e,f){return{name:a,start:b,end:c,total:"number"!=typeof b||"number"!=typeof c?void 0:c-b,colour:d,segments:e,rawResource:f}},j=function(a,c,d){var e=b.newTag("div",{"class":"legend-holder"});e.appendChild(b.newTag("h4",{text:c}));var f=b.newTag("dl",{"class":"legend "+a});return d.forEach(function(a){f.appendChild(b.newTag("dt",{"class":"colorBoxHolder",childElement:b.newTag("span",{},"background:"+a[1])})),f.appendChild(b.newTag("dd",{text:a[0]}))}),e.appendChild(f),e},k=[f("Unload",c.unloadEventStart,c.unloadEventEnd,"#909"),f("Redirect",c.redirectStart,c.redirectEnd,"#ffff60"),f("App cache",c.fetchStart,c.domainLookupStart,"#1f831f"),f("DNS",c.domainLookupStart,c.domainLookupEnd,"#1f7c83"),f("TCP",c.connectStart,c.connectEnd,"#e58226"),f("Timer to First Byte",c.requestStart,c.responseStart,"#1fe11f"),f("Response",c.responseStart,c.responseEnd,"#1977dd"),f("DOM Processing",c.domLoading,c.domComplete,"#9cc"),f("domContentLoaded Event",c.domContentLoadedEventStart,c.domContentLoadedEventEnd,"#d888df"),f("Onload Event",c.loadEventStart,c.loadEventEnd,"#c0c0ff")];c.secureConnectionStart&&k.push(f("SSL",c.connectStart,c.secureConnectionStart,"#c141cd")),c.msFirstPaint&&k.push(f("msFirstPaint Event",c.msFirstPaint,c.msFirstPaint,"#8FBC83")),c.domInteractive&&k.push(f("domInteractive Event",c.domInteractive,c.domInteractive,"#d888df")),!c.redirectEnd&&!c.redirectStart&&c.fetchStart>c.navigationStart&&k.push(f("Cross-Domain Redirect",c.navigationStart,c.fetchStart,"#ffff60")),c.blocks=[g("Navigation API total",0,c.loadEventEnd,"#ccc",k)],i.allResourcesCalc.forEach(function(b){var d=[f("Redirect",b.redirectStart,b.redirectEnd,"#ffff60"),f("DNS Lookup",b.domainLookupStart,b.domainLookupEnd,"#1f7c83"),f("Initial Connection (TCP)",b.connectStart,b.connectEnd,"#e58226"),f("secureConnect",b.secureConnectionStart||void 0,b.connectEnd,"#c141cd"),f("Timer to First Byte",b.requestStart,b.responseStart,"#1fe11f"),f("Content Download",b.responseStart||void 0,b.responseEnd,"#1977dd")],e=[0,b.redirectStart,b.domainLookupStart,b.connectStart,b.secureConnectionStart,b.requestStart,b.responseStart],h=e.reduce(function(a,c){return c>0&&(a>c||0>=a)&&c!=b.startTime?c:a});b.startTime<h&&d.unshift(f("Stalled/Blocking",b.startTime,h,"#cdcdcd")),c.blocks.push(g(b.name,Math.round(b.startTime),Math.round(b.responseEnd),a.getInitiatorTypeColour(b.initiatorType),d,b)),c.lastResponseEnd=Math.max(c.lastResponseEnd,b.responseEnd)}),c.loadDuration=Math.round(c.lastResponseEnd);var l=function(a,c){var e=a/100,f=c.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),g=i.marks.length>0?i.marks.reduce(function(a,b){return Math.max("number"==typeof a?a:0,h.getNodeTextWidth(h.newTextEl(b.name,"0")))}):0,k=25*(f.length+1),l=k+g+35,m=b.newTag("section",{"class":"resource-timing water-fall-holder chart-holder"}),n=h.newEl("svg:svg",{height:Math.floor(l),"class":"water-fall-chart"}),o=h.newEl("g",{"class":"labels"}),p=h.newEl("line",{x1:"0",y1:"0",x2:"0",y2:k,"class":"line-end"}),q=h.newEl("line",{x1:"0",y1:"0",x2:"0",y2:k,"class":"line-start"}),r=function(a){var c=a.target;b.addClass(c,"active");var d=c.x.baseVal.valueInSpecifiedUnits+c.width.baseVal.valueInSpecifiedUnits+"%",e=c.x.baseVal.valueInSpecifiedUnits+"%";p.x1.baseVal.valueAsString=d,p.x2.baseVal.valueAsString=d,q.x1.baseVal.valueAsString=e,q.x2.baseVal.valueAsString=e,b.addClass(p,"active"),b.addClass(q,"active"),c.parentNode.appendChild(p),c.parentNode.appendChild(q)},s=function(a){b.removeClass(a.target,"active"),b.removeClass(p,"active"),b.removeClass(q,"active")},t=function(a,b,c,d,f,g,i){var j,k=h.newEl("rect",{width:a/e+"%",height:b-1,x:c/e+"%",y:d,fill:f,"class":i&&i.length>0?"time-block":"segment"});return g&&k.appendChild(h.newEl("title",{text:g})),k.addEventListener("mouseenter",r),k.addEventListener("mouseleave",s),i&&i.length>0?(j=h.newEl("g"),j.appendChild(k),i.forEach(function(a){a.total>0&&"number"==typeof a.start&&j.appendChild(t(a.total,8,a.start||.001,d,a.colour,a.name+" ("+Math.round(a.start)+"ms - "+Math.round(a.end)+"ms | total: "+Math.round(a.total)+"ms)"))}),j):k},u=function(){for(var b=h.newEl("g",{"class":"time-scale full-width"}),c=0,d=a/1e3,e=100/d;d>=c;c++){var f=h.newTextEl(c+"sec",k);c>d-.2?(f.setAttribute("x",e*c-.5+"%"),f.setAttribute("text-anchor","end")):f.setAttribute("x",e*c+.5+"%");var g=h.newEl("line",{x1:e*c+"%",y1:"0",x2:e*c+"%",y2:k});b.appendChild(g),b.appendChild(f)}return b},v=function(){var a=h.newEl("g",{transform:"scale(1, 1)","class":"marker-holder"});return i.marks.forEach(function(c,d){var f=h.newEl("g",{"class":"mark-holder"}),g=h.newEl("g",{"class":"line-holder"}),j=c.startTime/e;c.x=j;var l=h.newTextEl(c.name,k+25);l.setAttribute("writing-mode","tb"),
l.setAttribute("x",j+"%"),l.setAttribute("stroke",""),g.appendChild(h.newEl("line",{x1:j+"%",y1:0,x2:j+"%",y2:k})),i.marks[d-1]&&c.x-i.marks[d-1].x<1&&(l.setAttribute("x",i.marks[d-1].x+1+"%"),c.x=i.marks[d-1].x+1),g.appendChild(h.newEl("line",{x1:j+"%",y1:k,x2:c.x+"%",y2:k+23})),l.addEventListener("mouseenter",function(){b.addClass(g,"active"),f.parentNode.appendChild(f)}),l.addEventListener("mouseleave",function(){b.removeClass(g,"active")}),f.appendChild(h.newEl("title",{text:c.name+" ("+Math.round(c.startTime)+"ms)"})),f.appendChild(g),f.appendChild(l),a.appendChild(f)}),a};n.appendChild(u()),n.appendChild(v()),f.forEach(function(a,b){var c=a.total||1,d=25*b;n.appendChild(t(c,25,a.start||.001,d,a.colour,a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)",a.segments));var f=h.newTextEl(a.name+" ("+a.total+"ms)",d+20);(a.total||1)/e>10&&h.getNodeTextWidth(f)<200?(f.setAttribute("class","inner-label"),f.setAttribute("x",(a.start||.001)/e+.5+"%"),f.setAttribute("width",c/e+"%")):(a.start||.001)/e+c/e<80?f.setAttribute("x",(a.start||.001)/e+c/e+.5+"%"):(f.setAttribute("x",(a.start||.001)/e-.5+"%"),f.setAttribute("text-anchor","end")),f.style.opacity=a.name.match(/js.map$/)?"0.5":"1",o.appendChild(f)}),n.appendChild(o),m.appendChild(b.newTag("h1",{text:"Resource Timing"})),m.appendChild(n),m.appendChild(b.newTag("h3",{text:"Legend"}));var w=b.newTag("div",{"class":"legends-group "});w.appendChild(j("initiator-type-legend","Block color: Initiator Type",[["css","#afd899"],["iframe","#85b3f2"],["img","#bc9dd6"],["script","#e7bd8c"],["link","#89afe6"],["swf","#4db3ba"],["xmlhttprequest","#e7d98c"]])),w.appendChild(j("navigation-legend","Navigation Timing",[["Redirect","#ffff60"],["App Cache","#1f831f"],["DNS Lookup","#1f7c83"],["TCP","#e58226"],["SSL Negotiation","#c141cd"],["Time to First Byte","#1fe11f"],["Content Download","#1977dd"],["DOM Processing","#9cc"],["DOM Content Loaded","#d888df"],["On Load","#c0c0ff"]])),w.appendChild(j("resource-legend","Resource Timing",[["Stalled/Blocking","#cdcdcd"],["Redirect","#ffff60"],["App Cache","#1f831f"],["DNS Lookup","#1f7c83"],["TCP","#e58226"],["SSL Negotiation","#c141cd"],["Initial Connection (TCP)","#e58226"],["Time to First Byte","#1fe11f"],["Content Download","#1977dd"]])),m.appendChild(w),d.appendChild(m)};l(c.loadDuration,c.blocks)}),l(function(){b.body.appendChild(c),a.style.height=c.clientHeight+"px",j.forEach(function(a){a.data.length>0&&console.table&&(console.log("\n\n\n"+a.name+":"),console.table(a.data,a.columns))})})}}();